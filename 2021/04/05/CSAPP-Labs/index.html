<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","version":"8.0.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}};
  </script>

  <meta name="description" content="实验记录及感悟">
<meta property="og:type" content="article">
<meta property="og:title" content="CSAPP-Labs">
<meta property="og:url" content="http://example.com/2021/04/05/CSAPP-Labs/index.html">
<meta property="og:site_name" content="FEZ的博客">
<meta property="og:description" content="实验记录及感悟">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2021/04/05/CSAPP-Labs/bomblab_tree.png">
<meta property="article:published_time" content="2021-04-05T13:52:15.000Z">
<meta property="article:modified_time" content="2021-08-03T16:10:13.742Z">
<meta property="article:author" content="FEZ">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2021/04/05/CSAPP-Labs/bomblab_tree.png">


<link rel="canonical" href="http://example.com/2021/04/05/CSAPP-Labs/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>CSAPP-Labs | FEZ的博客</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?7035c3f4ba1040e0d1972d11a3943ebb";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">FEZ的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <section class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#DataLab"><span class="nav-number">1.</span> <span class="nav-text">DataLab</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E5%86%85%E5%AE%B9"><span class="nav-number">1.1.</span> <span class="nav-text">实验内容</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%84%9F%E6%82%9F"><span class="nav-number">1.2.</span> <span class="nav-text">感悟</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#BombLab"><span class="nav-number">2.</span> <span class="nav-text">BombLab</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#phase-1"><span class="nav-number">2.1.</span> <span class="nav-text">phase_1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#phase-2"><span class="nav-number">2.2.</span> <span class="nav-text">phase_2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#phase-3"><span class="nav-number">2.3.</span> <span class="nav-text">phase_3</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#phase-4"><span class="nav-number">2.4.</span> <span class="nav-text">phase_4</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#phase-5"><span class="nav-number">2.5.</span> <span class="nav-text">phase_5</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#phase-6"><span class="nav-number">2.6.</span> <span class="nav-text">phase_6</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#secret-phase"><span class="nav-number">2.7.</span> <span class="nav-text">secret_phase</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ArchitectureLab"><span class="nav-number">3.</span> <span class="nav-text">ArchitectureLab</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%86%E5%A4%87"><span class="nav-number">3.1.</span> <span class="nav-text">准备</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Part-A"><span class="nav-number">3.2.</span> <span class="nav-text">Part A</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#sum-ys"><span class="nav-number">3.2.1.</span> <span class="nav-text">sum.ys</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rsum-ys"><span class="nav-number">3.2.2.</span> <span class="nav-text">rsum.ys</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#copy-ys"><span class="nav-number">3.2.3.</span> <span class="nav-text">copy.ys</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Part-B"><span class="nav-number">3.3.</span> <span class="nav-text">Part B</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Part-C"><span class="nav-number">3.4.</span> <span class="nav-text">Part C</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93"><span class="nav-number">3.5.</span> <span class="nav-text">小结</span></a></li></ol></li></ol></div>
        </section>
        <!--/noindex-->

        <section class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="FEZ"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">FEZ</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">25</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </section>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/05/CSAPP-Labs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="FEZ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FEZ的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          CSAPP-Labs
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-04-05 21:52:15" itemprop="dateCreated datePublished" datetime="2021-04-05T21:52:15+08:00">2021-04-05</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-08-04 00:10:13" itemprop="dateModified" datetime="2021-08-04T00:10:13+08:00">2021-08-04</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">学习</span></a>
        </span>
    </span>

  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>48k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>43 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>实验记录及感悟</p>
<a id="more"></a>

<h1 id="DataLab"><a href="#DataLab" class="headerlink" title="DataLab"></a>DataLab</h1><h2 id="实验内容"><a href="#实验内容" class="headerlink" title="实验内容"></a>实验内容</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * CS:APP Data Lab </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * &lt;Please put your name and userid here&gt;</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * bits.c - Source file with your solutions to the Lab.</span></span><br><span class="line"><span class="comment"> *          This is the file you will hand in to your instructor.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * WARNING: Do not include the &lt;stdio.h&gt; header; it confuses the dlc</span></span><br><span class="line"><span class="comment"> * compiler. You can still use printf for debugging without including</span></span><br><span class="line"><span class="comment"> * &lt;stdio.h&gt;, although you might get a compiler warning. In general,</span></span><br><span class="line"><span class="comment"> * it&#x27;s not good practice to ignore compiler warnings, but in this</span></span><br><span class="line"><span class="comment"> * case it&#x27;s OK.  </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> 0</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Instructions to Students:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * STEP 1: Read the following instructions carefully.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">You will provide your solution to the Data Lab by</span><br><span class="line">editing the collection of functions in <span class="keyword">this</span> source file.</span><br><span class="line"></span><br><span class="line">INTEGER CODING RULES:</span><br><span class="line"> </span><br><span class="line">  Replace the <span class="string">&quot;return&quot;</span> statement in each function with one</span><br><span class="line">  <span class="keyword">or</span> more lines of C code that implements the function. Your code </span><br><span class="line">  must conform to the following style:</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">Funct</span><span class="params">(arg1, arg2, ...)</span> </span>&#123;</span><br><span class="line">      <span class="comment">/* brief description of how your implementation works */</span></span><br><span class="line">      <span class="keyword">int</span> var1 = Expr1;</span><br><span class="line">      ...</span><br><span class="line">      <span class="keyword">int</span> varM = ExprM;</span><br><span class="line"></span><br><span class="line">      varJ = ExprJ;</span><br><span class="line">      ...</span><br><span class="line">      varN = ExprN;</span><br><span class="line">      <span class="keyword">return</span> ExprR;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Each <span class="string">&quot;Expr&quot;</span> is an expression <span class="keyword">using</span> ONLY the following:</span><br><span class="line">  <span class="number">1.</span> Integer constants <span class="number">0</span> through <span class="number">255</span> (<span class="number">0xFF</span>), inclusive. You are</span><br><span class="line">      <span class="keyword">not</span> allowed to use big constants such as <span class="number">0xffffffff</span>.</span><br><span class="line">  2. Function arguments and local variables (no global variables).</span><br><span class="line">  <span class="number">3.</span> Unary integer operations ! ~</span><br><span class="line">  <span class="number">4.</span> Binary integer operations &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="line">    </span><br><span class="line">  Some of the problems <span class="keyword">restrict</span> the <span class="built_in">set</span> of allowed operators even further.</span><br><span class="line">  Each <span class="string">&quot;Expr&quot;</span> may consist of multiple operators. You are <span class="keyword">not</span> restricted to</span><br><span class="line">  one <span class="keyword">operator</span> per line.</span><br><span class="line"></span><br><span class="line">  You are expressly forbidden to:</span><br><span class="line">  <span class="number">1.</span> Use any control constructs such as <span class="keyword">if</span>, <span class="keyword">do</span>, <span class="keyword">while</span>, <span class="keyword">for</span>, <span class="keyword">switch</span>, etc.</span><br><span class="line">  <span class="number">2.</span> Define <span class="keyword">or</span> use any macros.</span><br><span class="line">  <span class="number">3.</span> Define any additional functions in <span class="keyword">this</span> file.</span><br><span class="line">  <span class="number">4.</span> Call any functions.</span><br><span class="line">  <span class="number">5.</span> Use any other operations, such as &amp;&amp;, ||, -, <span class="keyword">or</span> ?:</span><br><span class="line">  <span class="number">6.</span> Use any form of casting.</span><br><span class="line">  <span class="number">7.</span> Use any data type other than <span class="keyword">int</span>.  This implies that you</span><br><span class="line">     cannot use arrays, structs, <span class="keyword">or</span> unions.</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">  You may assume that your machine:</span><br><span class="line">  <span class="number">1.</span> Uses <span class="number">2</span>s complement, <span class="number">32</span>-bit representations of integers.</span><br><span class="line">  <span class="number">2.</span> Performs right shifts arithmetically.</span><br><span class="line">  <span class="number">3.</span> Has unpredictable behavior when shifting <span class="keyword">if</span> the shift amount</span><br><span class="line">     is less than <span class="number">0</span> <span class="keyword">or</span> greater than <span class="number">31.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">EXAMPLES OF ACCEPTABLE CODING STYLE:</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * pow2plus1 - returns 2^x + 1, where 0 &lt;= x &lt;= 31</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">pow2plus1</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">     <span class="comment">/* exploit ability of shifts to compute powers of 2 */</span></span><br><span class="line">     <span class="keyword">return</span> (<span class="number">1</span> &lt;&lt; x) + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * pow2plus4 - returns 2^x + 4, where 0 &lt;= x &lt;= 31</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">pow2plus4</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">     <span class="comment">/* exploit ability of shifts to compute powers of 2 */</span></span><br><span class="line">     <span class="keyword">int</span> result = (<span class="number">1</span> &lt;&lt; x);</span><br><span class="line">     result += <span class="number">4</span>;</span><br><span class="line">     <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">FLOATING POINT CODING RULES</span><br><span class="line"></span><br><span class="line">For the problems that require you to implement floating-point operations,</span><br><span class="line">the coding rules are less strict.  You are allowed to use looping <span class="keyword">and</span></span><br><span class="line">conditional control.  You are allowed to use both ints <span class="keyword">and</span> unsigneds.</span><br><span class="line">You can use arbitrary integer <span class="keyword">and</span> <span class="keyword">unsigned</span> constants. You can use any arithmetic,</span><br><span class="line">logical, <span class="keyword">or</span> comparison operations on <span class="keyword">int</span> <span class="keyword">or</span> <span class="keyword">unsigned</span> data.</span><br><span class="line"></span><br><span class="line">You are expressly forbidden to:</span><br><span class="line">  <span class="number">1.</span> Define <span class="keyword">or</span> use any macros.</span><br><span class="line">  <span class="number">2.</span> Define any additional functions in <span class="keyword">this</span> file.</span><br><span class="line">  <span class="number">3.</span> Call any functions.</span><br><span class="line">  <span class="number">4.</span> Use any form of casting.</span><br><span class="line">  <span class="number">5.</span> Use any data type other than <span class="keyword">int</span> <span class="keyword">or</span> <span class="keyword">unsigned</span>.  This means that you</span><br><span class="line">     cannot use arrays, structs, <span class="keyword">or</span> unions.</span><br><span class="line">  <span class="number">6.</span> Use any floating point data types, operations, <span class="keyword">or</span> constants.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NOTES:</span><br><span class="line">  <span class="number">1.</span> <span class="function">Use the <span class="title">dlc</span> <span class="params">(data lab checker)</span> <span class="title">compiler</span> <span class="params">(described in the handout)</span> to </span></span><br><span class="line">     check the legality of your solutions.</span><br><span class="line">  <span class="number">2.</span> <span class="function">Each function has a maximum number of <span class="title">operations</span> <span class="params">(integer, logical,</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="keyword">or</span> comparison)</span> that you are allowed to use <span class="keyword">for</span> your implementation</span></span><br><span class="line">     of the function.  The max operator count is checked by dlc.</span><br><span class="line">     <span class="function">Note that <span class="title">assignment</span> <span class="params">(<span class="string">&#x27;=&#x27;</span>)</span> is <span class="keyword">not</span> counted</span>; you may use as many of</span><br><span class="line">     these as you want without penalty.</span><br><span class="line">  <span class="number">3.</span> Use the btest test harness to check your functions <span class="keyword">for</span> correctness.</span><br><span class="line">  <span class="number">4.</span> Use the BDD checker to formally verify your functions</span><br><span class="line">  <span class="number">5.</span> The maximum number of ops <span class="keyword">for</span> each function is given in the</span><br><span class="line">     header comment <span class="keyword">for</span> each function. If there are any inconsistencies </span><br><span class="line">     between the maximum ops in the writeup <span class="keyword">and</span> in <span class="keyword">this</span> file, consider</span><br><span class="line">     <span class="keyword">this</span> file the authoritative source.</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * STEP 2: Modify the following functions according the coding rules.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *   IMPORTANT. TO AVOID GRADING SURPRISES:</span></span><br><span class="line"><span class="comment"> *   1. Use the dlc compiler to check that your solutions conform</span></span><br><span class="line"><span class="comment"> *      to the coding rules.</span></span><br><span class="line"><span class="comment"> *   2. Use the BDD checker to formally verify that your solutions produce </span></span><br><span class="line"><span class="comment"> *      the correct answers.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="comment">//1</span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * bitXor - x^y using only ~ and &amp; </span></span><br><span class="line"><span class="comment"> *   Example: bitXor(4, 5) = 1</span></span><br><span class="line"><span class="comment"> *   Legal ops: ~ &amp;</span></span><br><span class="line"><span class="comment"> *   Max ops: 14</span></span><br><span class="line"><span class="comment"> *   Rating: 1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bitXor</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">     * x ^ y = (~x &amp; y) + (x &amp; ~y)</span></span><br><span class="line"><span class="comment">     * De Morgan&#x27;s Law : x + y = ~(x &amp; y)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">int</span> part_one = ~((~x) &amp; y);</span><br><span class="line">    <span class="keyword">int</span> part_two = ~((~y) &amp; x);</span><br><span class="line">    <span class="keyword">return</span> ~(part_one &amp; part_two);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * tmin - return minimum two&#x27;s complement integer </span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 4</span></span><br><span class="line"><span class="comment"> *   Rating: 1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">tmin</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="number">1</span> &lt;&lt; <span class="number">31</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//2</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * isTmax - returns 1 if x is the maximum, two&#x27;s complement number,</span></span><br><span class="line"><span class="comment"> *     and 0 otherwise </span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | +</span></span><br><span class="line"><span class="comment"> *   Max ops: 10</span></span><br><span class="line"><span class="comment"> *   Rating: 1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">isTmax</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">     * only when x = 0x7fffffff or x = 0xffffffff, x + x + 2 = 0</span></span><br><span class="line"><span class="comment">     * !(x + 1) is designed to distinguish between the two</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">return</span> !((x + x + <span class="number">2</span>) | (!(x + <span class="number">1</span>)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * allOddBits - return 1 if all odd-numbered bits in word set to 1</span></span><br><span class="line"><span class="comment"> *   where bits are numbered from 0 (least significant) to 31 (most significant)</span></span><br><span class="line"><span class="comment"> *   Examples allOddBits(0xFFFFFFFD) = 0, allOddBits(0xAAAAAAAA) = 1</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 12</span></span><br><span class="line"><span class="comment"> *   Rating: 2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">allOddBits</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    x = (x &gt;&gt; <span class="number">16</span>) &amp; x;</span><br><span class="line">    x = (x &gt;&gt; <span class="number">8</span> ) &amp; x;</span><br><span class="line">    x = (x &gt;&gt; <span class="number">4</span> ) &amp; x;</span><br><span class="line">    x = (x &gt;&gt; <span class="number">2</span> ) &amp; x;</span><br><span class="line">    x = (x &gt;&gt; <span class="number">1</span> ) &amp; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * negate - return -x </span></span><br><span class="line"><span class="comment"> *   Example: negate(1) = -1.</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 5</span></span><br><span class="line"><span class="comment"> *   Rating: 2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">negate</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (~x) + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//3</span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * isAsciiDigit - return 1 if 0x30 &lt;= x &lt;= 0x39 (ASCII codes for characters &#x27;0&#x27; to &#x27;9&#x27;)</span></span><br><span class="line"><span class="comment"> *   Example: isAsciiDigit(0x35) = 1.</span></span><br><span class="line"><span class="comment"> *            isAsciiDigit(0x3a) = 0.</span></span><br><span class="line"><span class="comment"> *            isAsciiDigit(0x05) = 0.</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 15</span></span><br><span class="line"><span class="comment"> *   Rating: 3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">isAsciiDigit</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">     * assume x = 0xMN</span></span><br><span class="line"><span class="comment">     * part_one check whether M is 3</span></span><br><span class="line"><span class="comment">     * part_two check whether N is bigger than 9</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">int</span> part_one = (x &gt;&gt; <span class="number">4</span>) ^ <span class="number">0x3</span>;</span><br><span class="line">    <span class="keyword">int</span> part_two = (x &gt;&gt; <span class="number">3</span>) &amp; (((x &gt;&gt; <span class="number">1</span>) &amp; <span class="number">1</span>) | ((x &gt;&gt; <span class="number">2</span>) &amp; <span class="number">1</span>));</span><br><span class="line">    <span class="keyword">return</span> !(part_one | part_two);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * conditional - same as x ? y : z </span></span><br><span class="line"><span class="comment"> *   Example: conditional(2,4,5) = 4</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 16</span></span><br><span class="line"><span class="comment"> *   Rating: 3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">conditional</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> z)</span> </span>&#123;</span><br><span class="line">    x = (x &lt;&lt; <span class="number">16</span>) | x;</span><br><span class="line">    x = (x &lt;&lt; <span class="number">8</span> ) | x;</span><br><span class="line">    x = (x &lt;&lt; <span class="number">4</span> ) | x;</span><br><span class="line">    x = (x &lt;&lt; <span class="number">2</span> ) | x;</span><br><span class="line">    x = (x &lt;&lt; <span class="number">1</span> ) | x;</span><br><span class="line">    x = x &gt;&gt; <span class="number">31</span>;</span><br><span class="line">    <span class="keyword">return</span> (x &amp; y) + ((~x) &amp; z);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * isLessOrEqual - if x &lt;= y  then return 1, else return 0 </span></span><br><span class="line"><span class="comment"> *   Example: isLessOrEqual(4,5) = 1.</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 24</span></span><br><span class="line"><span class="comment"> *   Rating: 3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">isLessOrEqual</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x_sign = x &gt;&gt; <span class="number">31</span>;</span><br><span class="line">    <span class="keyword">int</span> y_sign = y &gt;&gt; <span class="number">31</span>;</span><br><span class="line">    <span class="keyword">int</span> y_twos_complement = (~y) + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if x == y,x_equal_y = 1</span></span><br><span class="line">    <span class="keyword">int</span> x_equal_y = !(x ^ y);</span><br><span class="line">    <span class="comment">// when x &gt; 0, y &gt; 0, if x &lt; y, then xpyp is negative</span></span><br><span class="line">    <span class="keyword">int</span> xpyp = ((~(x_sign | y_sign)) &amp; (x + y_twos_complement)) &gt;&gt; <span class="number">31</span>;</span><br><span class="line">    <span class="comment">// if x &lt; 0, y &gt; 0, xnyp always be negative</span></span><br><span class="line">    <span class="keyword">int</span> xnyp = (x_sign &amp; (~y_sign));</span><br><span class="line">    <span class="comment">// when x &lt; 0, y &lt; 0, if x &lt; y, then xnyn is negative</span></span><br><span class="line">    <span class="keyword">int</span> xnyn = ((x_sign &amp; y_sign) &amp; (x + y_twos_complement)) &gt;&gt; <span class="number">31</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (x_equal_y + xpyp + xnyp + xnyn) &amp; <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//4</span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * logicalNeg - implement the ! operator, using all of </span></span><br><span class="line"><span class="comment"> *              the legal operators except !</span></span><br><span class="line"><span class="comment"> *   Examples: logicalNeg(3) = 0, logicalNeg(0) = 1</span></span><br><span class="line"><span class="comment"> *   Legal ops: ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 12</span></span><br><span class="line"><span class="comment"> *   Rating: 4 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">logicalNeg</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    x = (x &gt;&gt; <span class="number">16</span>) | x;</span><br><span class="line">    x = (x &gt;&gt; <span class="number">8</span> ) | x;</span><br><span class="line">    x = (x &gt;&gt; <span class="number">4</span> ) | x;</span><br><span class="line">    x = (x &gt;&gt; <span class="number">2</span> ) | x;</span><br><span class="line">    x = (x &gt;&gt; <span class="number">1</span> ) | x;</span><br><span class="line">    <span class="keyword">return</span> (~x) &amp; <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* howManyBits - return the minimum number of bits required to represent x in</span></span><br><span class="line"><span class="comment"> *             two&#x27;s complement</span></span><br><span class="line"><span class="comment"> *  Examples: howManyBits(12) = 5</span></span><br><span class="line"><span class="comment"> *            howManyBits(298) = 10</span></span><br><span class="line"><span class="comment"> *            howManyBits(-5) = 4</span></span><br><span class="line"><span class="comment"> *            howManyBits(0)  = 1</span></span><br><span class="line"><span class="comment"> *            howManyBits(-1) = 1</span></span><br><span class="line"><span class="comment"> *            howManyBits(0x80000000) = 32</span></span><br><span class="line"><span class="comment"> *  Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *  Max ops: 90</span></span><br><span class="line"><span class="comment"> *  Rating: 4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">howManyBits</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> sign = x &gt;&gt; <span class="number">31</span>;</span><br><span class="line">    <span class="keyword">int</span> minus_power16 = (~(<span class="number">1</span> &lt;&lt; <span class="number">16</span>)) + <span class="number">1</span>;   <span class="comment">// - 2 ^ 16</span></span><br><span class="line">    <span class="keyword">int</span> minus_power8 = (~(<span class="number">1</span> &lt;&lt; <span class="number">8</span>)) + <span class="number">1</span>;     <span class="comment">// - 2 ^ 8</span></span><br><span class="line">    <span class="keyword">int</span> minus_power4 = (~<span class="number">16</span>) + <span class="number">1</span>;           <span class="comment">// - 2 ^ 4</span></span><br><span class="line">    <span class="keyword">int</span> minus_power2 = (~<span class="number">4</span>) + <span class="number">1</span>;            <span class="comment">// - 2 ^ 2</span></span><br><span class="line">    <span class="keyword">int</span> minus_power1 = (~<span class="number">2</span>) + <span class="number">1</span>;            <span class="comment">// - 2 ^ 1</span></span><br><span class="line">    <span class="keyword">int</span> tempX, tempAns;</span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// if x is greater than 0, x stays the same, otherwise we reverse it</span></span><br><span class="line">    x = ((~sign) &amp; x) | (sign &amp; (~x));</span><br><span class="line"></span><br><span class="line">    tempX = (x + minus_power16) &gt;&gt; <span class="number">31</span>;</span><br><span class="line">    tempAns = ((~tempX) &amp; <span class="number">16</span>);</span><br><span class="line">    ans += tempAns;</span><br><span class="line">    x &gt;&gt;= tempAns;</span><br><span class="line"></span><br><span class="line">    tempX = (x + minus_power8) &gt;&gt; <span class="number">31</span>;</span><br><span class="line">    tempAns = ((~tempX) &amp; <span class="number">8</span>);</span><br><span class="line">    ans += tempAns;</span><br><span class="line">    x &gt;&gt;= tempAns;</span><br><span class="line"></span><br><span class="line">    tempX = (x + minus_power4) &gt;&gt; <span class="number">31</span>;</span><br><span class="line">    tempAns = ((~tempX) &amp; <span class="number">4</span>);</span><br><span class="line">    ans += tempAns;</span><br><span class="line">    x &gt;&gt;= tempAns;</span><br><span class="line"></span><br><span class="line">    tempX = (x + minus_power2) &gt;&gt; <span class="number">31</span>;</span><br><span class="line">    tempAns = ((~tempX) &amp; <span class="number">2</span>);</span><br><span class="line">    ans += tempAns;</span><br><span class="line">    x &gt;&gt;= tempAns;</span><br><span class="line"></span><br><span class="line">    tempX = (x + minus_power1) &gt;&gt; <span class="number">31</span>;</span><br><span class="line">    tempAns = ((~tempX) &amp; <span class="number">1</span>);</span><br><span class="line">    ans += tempAns;</span><br><span class="line">    x &gt;&gt;= tempAns;</span><br><span class="line"></span><br><span class="line">    tempX = (x + (~<span class="number">0</span>)) &gt;&gt; <span class="number">31</span>;</span><br><span class="line">    tempAns = ((~tempX) &amp; <span class="number">1</span>);</span><br><span class="line">    ans += tempAns;</span><br><span class="line">    x &gt;&gt;= tempAns;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> + ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//float</span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * floatScale2 - Return bit-level equivalent of expression 2*f for</span></span><br><span class="line"><span class="comment"> *   floating point argument f.</span></span><br><span class="line"><span class="comment"> *   Both the argument and result are passed as unsigned int&#x27;s, but</span></span><br><span class="line"><span class="comment"> *   they are to be interpreted as the bit-level representation of</span></span><br><span class="line"><span class="comment"> *   single-precision floating point values.</span></span><br><span class="line"><span class="comment"> *   When argument is NaN, return argument</span></span><br><span class="line"><span class="comment"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while</span></span><br><span class="line"><span class="comment"> *   Max ops: 30</span></span><br><span class="line"><span class="comment"> *   Rating: 4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="title">floatScale2</span><span class="params">(<span class="keyword">unsigned</span> uf)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> sign = (<span class="number">1</span> &lt;&lt; <span class="number">31</span>) &amp; uf;</span><br><span class="line">    <span class="keyword">unsigned</span> exponent = (sign ^ uf) &gt;&gt; <span class="number">23</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> frac = (sign | (exponent &lt;&lt; <span class="number">23</span>)) ^ uf;</span><br><span class="line">    <span class="keyword">if</span> (exponent == <span class="number">0xff</span>) <span class="keyword">return</span> uf;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (exponent == <span class="number">0xfe</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> sign | (<span class="number">0xff</span> &lt;&lt; <span class="number">23</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (exponent == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> sign | (frac &lt;&lt; <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">        <span class="keyword">return</span> sign | ((exponent + <span class="number">1</span>) &lt;&lt; <span class="number">23</span>) | frac;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * floatFloat2Int - Return bit-level equivalent of expression (int) f</span></span><br><span class="line"><span class="comment"> *   for floating point argument f.</span></span><br><span class="line"><span class="comment"> *   Argument is passed as unsigned int, but</span></span><br><span class="line"><span class="comment"> *   it is to be interpreted as the bit-level representation of a</span></span><br><span class="line"><span class="comment"> *   single-precision floating point value.</span></span><br><span class="line"><span class="comment"> *   Anything out of range (including NaN and infinity) should return</span></span><br><span class="line"><span class="comment"> *   0x80000000u.</span></span><br><span class="line"><span class="comment"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while</span></span><br><span class="line"><span class="comment"> *   Max ops: 30</span></span><br><span class="line"><span class="comment"> *   Rating: 4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">floatFloat2Int</span><span class="params">(<span class="keyword">unsigned</span> uf)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> sign = uf &amp; <span class="number">0x80000000</span>;</span><br><span class="line">    <span class="keyword">int</span> exponent = ((sign ^ uf) &gt;&gt; <span class="number">23</span>) - <span class="number">127</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> frac = uf &amp; <span class="number">0x7ffff</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> ans = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (exponent &gt; <span class="number">30</span>) <span class="keyword">return</span> <span class="number">0x80000000</span>u;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (exponent &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (exponent &gt;= <span class="number">23</span>)</span><br><span class="line">        ans = (frac | <span class="number">0x800000</span>) &lt;&lt; (exponent - <span class="number">23</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        ans = (frac | <span class="number">0x800000</span>) &gt;&gt; (<span class="number">23</span> - exponent);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (sign)</span><br><span class="line">        ans = (~ans) + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * floatPower2 - Return bit-level equivalent of the expression 2.0^x</span></span><br><span class="line"><span class="comment"> *   (2.0 raised to the power x) for any 32-bit integer x.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   The unsigned value that is returned should have the identical bit</span></span><br><span class="line"><span class="comment"> *   representation as the single-precision floating-point number 2.0^x.</span></span><br><span class="line"><span class="comment"> *   If the result is too small to be represented as a denorm, return</span></span><br><span class="line"><span class="comment"> *   0. If too large, return +INF.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. Also if, while </span></span><br><span class="line"><span class="comment"> *   Max ops: 30 </span></span><br><span class="line"><span class="comment"> *   Rating: 4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="title">floatPower2</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &gt;= <span class="number">128</span>) <span class="keyword">return</span> <span class="number">0x7f800000</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (x &gt;= <span class="number">-126</span>) <span class="keyword">return</span> (x + <span class="number">127</span>) &lt;&lt; <span class="number">23</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (x &gt;= <span class="number">-150</span>) <span class="keyword">return</span> <span class="number">1</span> &lt;&lt; (x + <span class="number">150</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="感悟"><a href="#感悟" class="headerlink" title="感悟"></a>感悟</h2><p>在看CSAPP之前已经在许多课程中学过关于原码反码补码浮点数位运算等知识了，阅读本书第二章时总觉得自己都懂，没什么新东西了。于是乎直接被家庭作业及LAB教做人</p>
<p>这LAB可真够硬的</p>
<p>确实该保持谦卑：看似这些东西已经学了好几遍，都是草草了解基本概念，几乎没有上手实操过，比如将所学的知识投入应用解决什么实际问题啥的。感谢CSAPP给我这么一个机会，这课程评价如此之高，LAB足够硬核且有趣功不可没</p>
<p>让我沮丧的是有几个函数我没能独自完成，还没拼尽全力就放弃，求助于题解。按作者对CMU学子的要求，这种行为是作弊。我得承认我确实是作弊了，这弄得我很沮丧。当阅读了别人的题解后，我既惊叹于他们的思路与技巧，直呼“还可以这样”，但转念一想其实自己再努把力也未必想不到。但确实没能完全独自完成，后悔不及。</p>
<p>知耻而后勇，以此次作弊为鉴，之后的学习放低姿态，认真按照要求好好弄吧！</p>
<h1 id="BombLab"><a href="#BombLab" class="headerlink" title="BombLab"></a>BombLab</h1><h2 id="phase-1"><a href="#phase-1" class="headerlink" title="phase_1"></a>phase_1</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">反汇编main函数，找到phase_1()函数入口</span><br><span class="line">(gdb) disassemble main</span><br><span class="line">	...</span><br><span class="line">   0x0000000000400e32 &lt;+146&gt;:	callq  0x40149e &lt;read_line&gt;</span><br><span class="line">   0x0000000000400e37 &lt;+151&gt;:	mov    %rax,%rdi</span><br><span class="line">   0x0000000000400e3a &lt;+154&gt;:	callq  0x400ee0 &lt;phase_1&gt;</span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">phase_1()函数首地址为0x400ee0，接着反汇编phase_1()函数</span><br><span class="line">(gdb) disassemble 0x400ee0</span><br><span class="line">Dump of assembler code for function phase_1:</span><br><span class="line">   0x0000000000400ee0 &lt;+0&gt;:		sub    $0x8,%rsp</span><br><span class="line">   0x0000000000400ee4 &lt;+4&gt;:		mov    $0x402400,%esi</span><br><span class="line">   0x0000000000400ee9 &lt;+9&gt;:		callq  0x401338 &lt;strings_not_equal&gt;</span><br><span class="line">   0x0000000000400eee &lt;+14&gt;:	test   %eax,%eax</span><br><span class="line">   0x0000000000400ef0 &lt;+16&gt;:	je     0x400ef7 &lt;phase_1+23&gt;</span><br><span class="line">   0x0000000000400ef2 &lt;+18&gt;:	callq  0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000400ef7 &lt;+23&gt;:	add    $0x8,%rsp</span><br><span class="line">   0x0000000000400efb &lt;+27&gt;:	retq   </span><br><span class="line">End of assembler dump.</span><br><span class="line"></span><br><span class="line">简要分析，phase_1()函数调用首地址为0x401338名为strings_not_equal()的函数，后者通过%rax寄存器返回一个值。若该值为0，炸弹拆除成功；否则炸弹爆炸，于是接着反汇编string_not_euqal()函数</span><br><span class="line">(gdb) disassemble 0x401338</span><br><span class="line">	...</span><br><span class="line">   0x000000000040133c &lt;+4&gt;:		mov    %rdi,%rbx</span><br><span class="line">   0x000000000040133f &lt;+7&gt;:		mov    %rsi,%rbp</span><br><span class="line">   0x0000000000401342 &lt;+10&gt;:	callq  0x40131b &lt;string_length&gt;</span><br><span class="line">   0x0000000000401347 &lt;+15&gt;:	mov    %eax,%r12d</span><br><span class="line">   0x000000000040134a &lt;+18&gt;:	mov    %rbp,%rdi</span><br><span class="line">   0x000000000040134d &lt;+21&gt;:	callq  0x40131b &lt;string_length&gt;</span><br><span class="line">   0x0000000000401352 &lt;+26&gt;:	mov    $0x1,%edx</span><br><span class="line">   0x0000000000401357 &lt;+31&gt;:	cmp    %eax,%r12d</span><br><span class="line">   0x000000000040135a &lt;+34&gt;:	jne    0x40139b &lt;strings_not_equal+99&gt;</span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">该函数又会调用首地址为0x40131b名为string_length()的函数，并比较二者返回值是否相同，若不同则strings_not_equal()通过%rax返回值1，最终炸弹爆炸，继续反汇编string_length()函数</span><br><span class="line">(gdb) disassemble 0x40131b</span><br><span class="line">Dump of assembler code for function string_length:</span><br><span class="line">   0x000000000040131b &lt;+0&gt;:		cmpb   $0x0,(%rdi)</span><br><span class="line">   0x000000000040131e &lt;+3&gt;:		je     0x401332 &lt;string_length+23&gt;</span><br><span class="line">   0x0000000000401320 &lt;+5&gt;:		mov    %rdi,%rdx</span><br><span class="line">   0x0000000000401323 &lt;+8&gt;:		add    $0x1,%rdx</span><br><span class="line">   0x0000000000401327 &lt;+12&gt;:	mov    %edx,%eax</span><br><span class="line">   0x0000000000401329 &lt;+14&gt;:	sub    %edi,%eax</span><br><span class="line">   0x000000000040132b &lt;+16&gt;:	cmpb   $0x0,(%rdx)</span><br><span class="line">   0x000000000040132e &lt;+19&gt;:	jne    0x401323 &lt;string_length+8&gt;</span><br><span class="line">   0x0000000000401330 &lt;+21&gt;:	repz retq </span><br><span class="line">   0x0000000000401332 &lt;+23&gt;:	mov    $0x0,%eax</span><br><span class="line">   0x0000000000401337 &lt;+28&gt;:	retq   </span><br><span class="line">End of assembler dump.</span><br><span class="line"></span><br><span class="line">分析得string_length()函数接收一个参数(存于%rdi中)，%rdi为一字符串首地址，string_length()函数从该首地址起将数据类型为byte的字符值逐个与值0x(&#39;\0&#39;)比较，最终利用%rax寄存器返回字符串长度，接着回到string_not_equal()函数中</span><br><span class="line">   0x000000000040135a &lt;+34&gt;:	jne    0x40139b &lt;strings_not_equal+99&gt;</span><br><span class="line">   0x000000000040135c &lt;+36&gt;:	movzbl (%rbx),%eax</span><br><span class="line">   0x000000000040135f &lt;+39&gt;:	test   %al,%al</span><br><span class="line">   0x0000000000401361 &lt;+41&gt;:	je     0x401388 &lt;strings_not_equal+80&gt;</span><br><span class="line">   0x0000000000401363 &lt;+43&gt;:	cmp    0x0(%rbp),%al</span><br><span class="line">   0x0000000000401366 &lt;+46&gt;:	je     0x401372 &lt;strings_not_equal+58&gt;</span><br><span class="line">   0x0000000000401368 &lt;+48&gt;:	jmp    0x40138f &lt;strings_not_equal+87&gt;</span><br><span class="line">   0x000000000040136a &lt;+50&gt;:	cmp    0x0(%rbp),%al</span><br><span class="line">   0x000000000040136d &lt;+53&gt;:	nopl   (%rax)</span><br><span class="line">   0x0000000000401370 &lt;+56&gt;:	jne    0x401396 &lt;strings_not_equal+94&gt;</span><br><span class="line">   0x0000000000401372 &lt;+58&gt;:	add    $0x1,%rbx</span><br><span class="line">   0x0000000000401376 &lt;+62&gt;:	add    $0x1,%rbp</span><br><span class="line">   0x000000000040137a &lt;+66&gt;:	movzbl (%rbx),%eax</span><br><span class="line">   0x000000000040137d &lt;+69&gt;:	test   %al,%al</span><br><span class="line">   0x000000000040137f &lt;+71&gt;:	jne    0x40136a &lt;strings_not_equal+50&gt;</span><br><span class="line">   0x0000000000401381 &lt;+73&gt;:	mov    $0x0,%edx</span><br><span class="line">   0x0000000000401386 &lt;+78&gt;:	jmp    0x40139b &lt;strings_not_equal+99&gt;</span><br><span class="line">   0x0000000000401388 &lt;+80&gt;:	mov    $0x0,%edx</span><br><span class="line">   0x000000000040138d &lt;+85&gt;:	jmp    0x40139b &lt;strings_not_equal+99&gt;</span><br><span class="line">   0x000000000040138f &lt;+87&gt;:	mov    $0x1,%edx</span><br><span class="line">   0x0000000000401394 &lt;+92&gt;:	jmp    0x40139b &lt;strings_not_equal+99&gt;</span><br><span class="line">   0x0000000000401396 &lt;+94&gt;:	mov    $0x1,%edx</span><br><span class="line">   0x000000000040139b &lt;+99&gt;:	mov    %edx,%eax</span><br><span class="line"></span><br><span class="line">简要分析得首地址为0x40135a的指令判断两字符串长度是否相同。若长度相同，则逐一比较两串是否逐字符相同。若两串完全相同，则函数返回0；若任意字符不同，函数返回1</span><br><span class="line">分析至此知本题关键在于如何获知模式串内容。观察知当通过string_length()函数计算字符串长度时，待计算字符串的首地址需通过%rdi寄存器传入函数中，而由string_not_equal()中</span><br><span class="line">   0x000000000040133c &lt;+4&gt;:		mov    %rdi,%rbx</span><br><span class="line">   0x000000000040133f &lt;+7&gt;:		mov    %rsi,%rbp</span><br><span class="line">   0x0000000000401342 &lt;+10&gt;:	callq  0x40131b &lt;string_length&gt;</span><br><span class="line">   0x0000000000401347 &lt;+15&gt;:	mov    %eax,%r12d</span><br><span class="line">   0x000000000040134a &lt;+18&gt;:	mov    %rbp,%rdi</span><br><span class="line">   0x000000000040134d &lt;+21&gt;:	callq  0x40131b &lt;string_length&gt;</span><br><span class="line">   </span><br><span class="line">知，两次调用string_length()函数时分别传入了%rdi与%rsi中的值，而又由phase_1()</span><br><span class="line">   0x0000000000400ee4 &lt;+4&gt;:	mov    $0x402400,%esi</span><br><span class="line">   0x0000000000400ee9 &lt;+9&gt;:	callq  0x401338 &lt;strings_not_equal&gt;</span><br><span class="line">   </span><br><span class="line">知，%rsi为定值$0x402400，不难得出该定值为模式串首地址</span><br><span class="line"></span><br><span class="line">(gdb) x &#x2F;s 0x402400</span><br><span class="line">0x402400:	&quot;Border relations with Canada have never been better.&quot;</span><br><span class="line">得答案</span><br></pre></td></tr></table></figure>

<h2 id="phase-2"><a href="#phase-2" class="headerlink" title="phase_2"></a>phase_2</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">反汇编main函数，找到phase_2()函数入口</span><br><span class="line">   0x0000000000400e56 &lt;+182&gt;:	callq  0x400efc &lt;phase_2&gt;</span><br><span class="line"></span><br><span class="line">phase_2()函数首地址为0x400efc，接着反汇编phase_2()函数</span><br><span class="line">   0x0000000000400efe &lt;+2&gt;:		sub    $0x28,%rsp</span><br><span class="line">   0x0000000000400f02 &lt;+6&gt;:		mov    %rsp,%rsi</span><br><span class="line">   0x0000000000400f05 &lt;+9&gt;:		callq  0x40145c &lt;read_six_numbers&gt;</span><br><span class="line">   0x0000000000400f0a &lt;+14&gt;:	cmpl   $0x1,(%rsp)</span><br><span class="line">   0x0000000000400f0e &lt;+18&gt;:	je     0x400f30 &lt;phase_2+52&gt;</span><br><span class="line">   0x0000000000400f10 &lt;+20&gt;:	callq  0x40143a &lt;explode_bomb&gt;</span><br><span class="line"></span><br><span class="line">该函数在栈上开辟了40个字节大小的空间，设开辟后%rsp值为s0，接着调用首地址为0x40145c名为read_six_numbers()的函数，随后比较确认栈顶四字节大小的数据值是否为1，若不为1则炸弹爆炸，由此确定DWORD PTR 0(%rsp) &#x3D; 1，接着反汇编read_six_numbers()函数</span><br><span class="line">(gdb) disassemble 0x40145c</span><br><span class="line">Dump of assembler code for function read_six_numbers:</span><br><span class="line">   0x000000000040145c &lt;+0&gt;:		sub    $0x18,%rsp</span><br><span class="line">   0x0000000000401460 &lt;+4&gt;:		mov    %rsi,%rdx</span><br><span class="line">   0x0000000000401463 &lt;+7&gt;:		lea    0x4(%rsi),%rcx</span><br><span class="line">   0x0000000000401467 &lt;+11&gt;:	lea    0x14(%rsi),%rax</span><br><span class="line">   0x000000000040146b &lt;+15&gt;:	mov    %rax,0x8(%rsp)</span><br><span class="line">   0x0000000000401470 &lt;+20&gt;:	lea    0x10(%rsi),%rax</span><br><span class="line">   0x0000000000401474 &lt;+24&gt;:	mov    %rax,(%rsp)</span><br><span class="line">   0x0000000000401478 &lt;+28&gt;:	lea    0xc(%rsi),%r9</span><br><span class="line">   0x000000000040147c &lt;+32&gt;:	lea    0x8(%rsi),%r8</span><br><span class="line">   0x0000000000401480 &lt;+36&gt;:	mov    $0x4025c3,%esi</span><br><span class="line">   0x0000000000401485 &lt;+41&gt;:	mov    $0x0,%eax</span><br><span class="line">   0x000000000040148a &lt;+46&gt;:	callq  0x400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">   0x000000000040148f &lt;+51&gt;:	cmp    $0x5,%eax</span><br><span class="line">   0x0000000000401492 &lt;+54&gt;:	jg     0x401499 &lt;read_six_numbers+61&gt;</span><br><span class="line">   0x0000000000401494 &lt;+56&gt;:	callq  0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000401499 &lt;+61&gt;:	add    $0x18,%rsp</span><br><span class="line">   0x000000000040149d &lt;+65&gt;:	retq   </span><br><span class="line">End of assembler dump.</span><br><span class="line"></span><br><span class="line">分析得read_six_numbers()接收一个由%rsi传递来的一个参数，其值为s0，即phase_2()函数栈空间开辟后栈顶地址。而read_six_numbers()函数的作用为将用户输入的六个数字按顺序放于栈中(先输入者于栈顶)，再次返回phase_2()函数中</span><br><span class="line">   0x0000000000400f15 &lt;+25&gt;:	jmp    0x400f30 &lt;phase_2+52&gt;</span><br><span class="line">   0x0000000000400f17 &lt;+27&gt;:	mov    -0x4(%rbx),%eax</span><br><span class="line">   0x0000000000400f1a &lt;+30&gt;:	add    %eax,%eax</span><br><span class="line">   0x0000000000400f1c &lt;+32&gt;:	cmp    %eax,(%rbx)</span><br><span class="line">   0x0000000000400f1e &lt;+34&gt;:	je     0x400f25 &lt;phase_2+41&gt;</span><br><span class="line">   0x0000000000400f20 &lt;+36&gt;:	callq  0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000400f25 &lt;+41&gt;:	add    $0x4,%rbx</span><br><span class="line">   0x0000000000400f29 &lt;+45&gt;:	cmp    %rbp,%rbx</span><br><span class="line">   0x0000000000400f2c &lt;+48&gt;:	jne    0x400f17 &lt;phase_2+27&gt;</span><br><span class="line">   0x0000000000400f2e &lt;+50&gt;:	jmp    0x400f3c &lt;phase_2+64&gt;</span><br><span class="line">   0x0000000000400f30 &lt;+52&gt;:	lea    0x4(%rsp),%rbx</span><br><span class="line">   0x0000000000400f35 &lt;+57&gt;:	lea    0x18(%rsp),%rbp</span><br><span class="line">   0x0000000000400f3a &lt;+62&gt;:	jmp    0x400f17 &lt;phase_2+27&gt;</span><br><span class="line">自read_six_numbers()函数返回后，phase_2()函数剩余部分为一循环，由</span><br><span class="line">   0x0000000000400f17 &lt;+27&gt;:	mov    -0x4(%rbx),%eax</span><br><span class="line">   0x0000000000400f1a &lt;+30&gt;:	add    %eax,%eax</span><br><span class="line">   0x0000000000400f1c &lt;+32&gt;:	cmp    %eax,(%rbx)</span><br><span class="line">   0x0000000000400f1e &lt;+34&gt;:	je     0x400f25 &lt;phase_2+41&gt;</span><br><span class="line">   0x0000000000400f20 &lt;+36&gt;:	callq  0x40143a &lt;explode_bomb&gt;</span><br><span class="line">知，相邻输入的两数字，若后输入者的值不为前者两倍，则炸弹爆炸。而又由DWORD PTR 0(%rsp) &#x3D; 1知，六个数字分别为1，2，4，8，16，32</span><br></pre></td></tr></table></figure>

<h2 id="phase-3"><a href="#phase-3" class="headerlink" title="phase_3"></a>phase_3</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">反汇编phase_3()函数</span><br><span class="line">(gdb) disassemble phase_3</span><br><span class="line">Dump of assembler code for function phase_3:</span><br><span class="line">   0x0000000000400f43 &lt;+0&gt;:	sub    $0x18,%rsp</span><br><span class="line">   0x0000000000400f47 &lt;+4&gt;:	lea    0xc(%rsp),%rcx</span><br><span class="line">   0x0000000000400f4c &lt;+9&gt;:	lea    0x8(%rsp),%rdx</span><br><span class="line">   0x0000000000400f51 &lt;+14&gt;:	mov    $0x4025cf,%esi</span><br><span class="line">   0x0000000000400f56 &lt;+19&gt;:	mov    $0x0,%eax</span><br><span class="line">   0x0000000000400f5b &lt;+24&gt;:	callq  0x400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line"></span><br><span class="line">知phase_3()函数先将值$0x4025cf存于%esi中，接着调用sscanf()函数读取输入数据，尝试反汇编首地址为0x4025cf的内容</span><br><span class="line">(gdb) x &#x2F;s 0x4025cf</span><br><span class="line">0x4025cf:	&quot;%d %d&quot;</span><br><span class="line"></span><br><span class="line">得该谜题应输入两个数字，继续查看phase_3()代码</span><br><span class="line">   0x0000000000400f6a &lt;+39&gt;:	cmpl   $0x7,0x8(%rsp)</span><br><span class="line">   0x0000000000400f6f &lt;+44&gt;:	ja     0x400fad &lt;phase_3+106&gt;</span><br><span class="line">   0x0000000000400f71 &lt;+46&gt;:	mov    0x8(%rsp),%eax</span><br><span class="line">   0x0000000000400f75 &lt;+50&gt;:	jmpq   *0x402470(,%rax,8)</span><br><span class="line">   0x0000000000400f7c &lt;+57&gt;:	mov    $0xcf,%eax</span><br><span class="line">   0x0000000000400f81 &lt;+62&gt;:	jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400f83 &lt;+64&gt;:	mov    $0x2c3,%eax</span><br><span class="line">   0x0000000000400f88 &lt;+69&gt;:	jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400f8a &lt;+71&gt;:	mov    $0x100,%eax</span><br><span class="line">   0x0000000000400f8f &lt;+76&gt;:	jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400f91 &lt;+78&gt;:	mov    $0x185,%eax</span><br><span class="line">   0x0000000000400f96 &lt;+83&gt;:	jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400f98 &lt;+85&gt;:	mov    $0xce,%eax</span><br><span class="line">   0x0000000000400f9d &lt;+90&gt;:	jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400f9f &lt;+92&gt;:	mov    $0x2aa,%eax</span><br><span class="line">   0x0000000000400fa4 &lt;+97&gt;:	jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400fa6 &lt;+99&gt;:	mov    $0x147,%eax</span><br><span class="line">   0x0000000000400fab &lt;+104&gt;:	jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400fad &lt;+106&gt;:	callq  0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000400fb2 &lt;+111&gt;:	mov    $0x0,%eax</span><br><span class="line">   0x0000000000400fb7 &lt;+116&gt;:	jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400fb9 &lt;+118&gt;:	mov    $0x137,%eax</span><br><span class="line">   0x0000000000400fbe &lt;+123&gt;:	cmp    0xc(%rsp),%eax</span><br><span class="line">   0x0000000000400fc2 &lt;+127&gt;:	je     0x400fc9 &lt;phase_3+134&gt;</span><br><span class="line">   0x0000000000400fc4 &lt;+129&gt;:	callq  0x40143a &lt;explode_bomb&gt;</span><br><span class="line"></span><br><span class="line">由前两行知DWORD PTR 0x8(%rsp)中的值小于等于7，而</span><br><span class="line">   0x0000000000400f71 &lt;+46&gt;:	mov    0x8(%rsp),%eax</span><br><span class="line">   0x0000000000400f75 &lt;+50&gt;:	jmpq   *0x402470(,%rax,8)</span><br><span class="line">   </span><br><span class="line">结合后续一系列跳转指令知，这里实现了swtich语句的跳转表功能，以DWORD PTR 0x8(%rsp)中的值为偏移量实现跳转，基地址为0x402470，于是反汇编查看跳转表内容</span><br><span class="line">(gdb) x &#x2F;8xg 0x402470</span><br><span class="line">0x402470:	0x0000000000400f7c	0x0000000000400fb9</span><br><span class="line">0x402480:	0x0000000000400f83	0x0000000000400f8a</span><br><span class="line">0x402490:	0x0000000000400f91	0x0000000000400f98</span><br><span class="line">0x4024a0:	0x0000000000400f9f	0x0000000000400fa6</span><br><span class="line"></span><br><span class="line">当DWORD PTR 0x8(%rsp)值为0时，跳转至0x400f7c，再由后续几条指令知DWORD PTR 0xc(%rsp)的值应为0xcf，于是得本题一组解： [0, 207]，同理得其他七组解分别为[1, 311],[2, 707],[3, 256],[4, 389],[5, 206],[6, 682],[7, 147]</span><br></pre></td></tr></table></figure>

<h2 id="phase-4"><a href="#phase-4" class="headerlink" title="phase_4"></a>phase_4</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">反汇编phase_4()</span><br><span class="line">   0x0000000000401010 &lt;+4&gt;:		lea    0xc(%rsp),%rcx</span><br><span class="line">   0x0000000000401015 &lt;+9&gt;:		lea    0x8(%rsp),%rdx</span><br><span class="line">   0x000000000040101a &lt;+14&gt;:	mov    $0x4025cf,%esi</span><br><span class="line">   0x000000000040101f &lt;+19&gt;:	mov    $0x0,%eax</span><br><span class="line">   0x0000000000401024 &lt;+24&gt;:	callq  0x400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">   0x0000000000401029 &lt;+29&gt;:	cmp    $0x2,%eax</span><br><span class="line">   0x000000000040102c &lt;+32&gt;:	jne    0x401035 &lt;phase_4+41&gt;</span><br><span class="line"></span><br><span class="line">同phase_3()，易得该谜题需要两个输入</span><br><span class="line">   0x000000000040102e &lt;+34&gt;:	cmpl   $0xe,0x8(%rsp)</span><br><span class="line">   0x0000000000401033 &lt;+39&gt;:	jbe    0x40103a &lt;phase_4+46&gt;</span><br><span class="line">   0x0000000000401035 &lt;+41&gt;:	callq  0x40143a &lt;explode_bomb&gt;</span><br><span class="line"></span><br><span class="line">由上述三条指令知DOWRD PTR 0x8(%rsp)中的值小于等于14，即第一个数字应小于15</span><br><span class="line">   0x0000000000401051 &lt;+69&gt;:	cmpl   $0x0,0xc(%rsp)</span><br><span class="line">   0x0000000000401056 &lt;+74&gt;:	je     0x40105d &lt;phase_4+81&gt;</span><br><span class="line">   0x0000000000401058 &lt;+76&gt;:	callq  0x40143a &lt;explode_bomb&gt;</span><br><span class="line"></span><br><span class="line">同理知第二个数字必为0，接下来反汇编首地址为0x400fce的func4()函数</span><br><span class="line">   0x0000000000400fce &lt;+0&gt;:		sub    $0x8,%rsp</span><br><span class="line">   0x0000000000400fd2 &lt;+4&gt;:		mov    %edx,%eax</span><br><span class="line">   0x0000000000400fd4 &lt;+6&gt;:		sub    %esi,%eax</span><br><span class="line">   0x0000000000400fd6 &lt;+8&gt;:		mov    %eax,%ecx</span><br><span class="line">   0x0000000000400fd8 &lt;+10&gt;:	shr    $0x1f,%ecx</span><br><span class="line">   0x0000000000400fdb &lt;+13&gt;:	add    %ecx,%eax</span><br><span class="line">   0x0000000000400fdd &lt;+15&gt;:	sar    %eax</span><br><span class="line">   0x0000000000400fdf &lt;+17&gt;:	lea    (%rax,%rsi,1),%ecx</span><br><span class="line">   0x0000000000400fe2 &lt;+20&gt;:	cmp    %edi,%ecx</span><br><span class="line">   0x0000000000400fe4 &lt;+22&gt;:	jle    0x400ff2 &lt;func4+36&gt;</span><br><span class="line">   0x0000000000400fe6 &lt;+24&gt;:	lea    -0x1(%rcx),%edx</span><br><span class="line">   0x0000000000400fe9 &lt;+27&gt;:	callq  0x400fce &lt;func4&gt;</span><br><span class="line">   0x0000000000400fee &lt;+32&gt;:	add    %eax,%eax</span><br><span class="line">   0x0000000000400ff0 &lt;+34&gt;:	jmp    0x401007 &lt;func4+57&gt;</span><br><span class="line">   0x0000000000400ff2 &lt;+36&gt;:	mov    $0x0,%eax</span><br><span class="line">   0x0000000000400ff7 &lt;+41&gt;:	cmp    %edi,%ecx</span><br><span class="line">   0x0000000000400ff9 &lt;+43&gt;:	jge    0x401007 &lt;func4+57&gt;</span><br><span class="line">   0x0000000000400ffb &lt;+45&gt;:	lea    0x1(%rcx),%esi</span><br><span class="line">   0x0000000000400ffe &lt;+48&gt;:	callq  0x400fce &lt;func4&gt;</span><br><span class="line">   0x0000000000401003 &lt;+53&gt;:	lea    0x1(%rax,%rax,1),%eax</span><br><span class="line">   0x0000000000401007 &lt;+57&gt;:	add    $0x8,%rsp</span><br><span class="line">   0x000000000040100b &lt;+61&gt;:	retq   </span><br><span class="line"></span><br><span class="line">分析知该函数接收三个参数，分别存于%rdi, %rsi, %rdx中，尝试构造c函数</span><br><span class="line">int func4(int x, int y, int z) &#123;</span><br><span class="line">&#x2F;&#x2F;x in %rdi, y in %rsi, z in %rdx</span><br><span class="line">&#x2F;&#x2F;t &lt;-&gt; %rax  w &lt;-&gt; %rcx</span><br><span class="line">    if (z &gt;&#x3D; y) &#123;</span><br><span class="line">        t &#x3D; z - y;</span><br><span class="line">        w &#x3D; 0;</span><br><span class="line">        t &#x3D; (z - y) &#x2F; 2;</span><br><span class="line">        w &#x3D; (z + y) &#x2F; 2;</span><br><span class="line">        if (w &lt;&#x3D; x) &#123;</span><br><span class="line">            t &#x3D; 0;</span><br><span class="line">            if (w &#x3D;&#x3D; x) return t; </span><br><span class="line">            y &#x3D; (z + y) &#x2F; 2 + 1;</span><br><span class="line">            t &#x3D; func4(x, y, z);</span><br><span class="line">            return 2 * t + 1;</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            z &#x3D; (z + y) &#x2F; 2 - 1;</span><br><span class="line">            t &#x3D; func4(x, y, z);</span><br><span class="line">            return 2 * t;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else if (z &lt; y) &#123;</span><br><span class="line">        t &#x3D; z - y;</span><br><span class="line">        w &#x3D; -1;</span><br><span class="line">        t &#x3D; (z - y - 1) &#x2F; 2;</span><br><span class="line">        w &#x3D; (z + y - 1) &#x2F; 2;</span><br><span class="line">        if (w &lt;&#x3D; x) &#123;</span><br><span class="line">            t &#x3D; 0;</span><br><span class="line">            if (w &#x3D;&#x3D; x) return t; </span><br><span class="line">            y &#x3D; (z + y + 1) &#x2F; 2;</span><br><span class="line">            t &#x3D; func4(x, y, z);</span><br><span class="line">            return 2 * t + 1;</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            z &#x3D; (z + y - 1) &#x2F; 2 - 1;</span><br><span class="line">            t &#x3D; func4(x, y, z);</span><br><span class="line">            return 2 * t;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">而phase_4()调用本函数时，传入的x, y, z值分别为DWORD PTR 0x8(%rsp), 0, 14.我没有详细探究本函数实现的功能，而是将DWORD PTR 0x8(%rsp)可能的取值(0 ~ 14)全部带入算出结果，由phase_4()函数里</span><br><span class="line">   0x000000000040104d &lt;+65&gt;:	test   %eax,%eax</span><br><span class="line">   0x000000000040104f &lt;+67&gt;:	jne    0x401058 &lt;phase_4+76&gt;</span><br><span class="line"></span><br><span class="line">知，只有在func4()函数返回值为0的情况下炸弹才不会爆炸，因此第一个数可能的取值有0,1,3,7.</span><br><span class="line">即可选的答案有[0, 0], [1, 0], [3, 0], [7, 0]</span><br></pre></td></tr></table></figure>

<p>0x400fdd地址处的 sar    %eax指令只含一个操作数，实际上是sar    %eax, 1的隐含简写，见<br><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/12813962/sar-command-in-x86-assembly-with-one-parameter">SAR command in X86 assembly with one paramete</a></p>
<h2 id="phase-5"><a href="#phase-5" class="headerlink" title="phase_5"></a>phase_5</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">反汇编phase_5()函数</span><br><span class="line">   0x0000000000401063 &lt;+1&gt;:		sub    $0x20,%rsp</span><br><span class="line">   0x0000000000401067 &lt;+5&gt;:		mov    %rdi,%rbx</span><br><span class="line">   0x000000000040106a &lt;+8&gt;:		mov    %fs:0x28,%rax</span><br><span class="line">   0x0000000000401073 &lt;+17&gt;:	mov    %rax,0x18(%rsp)</span><br><span class="line">   0x0000000000401078 &lt;+22&gt;:	xor    %eax,%eax</span><br><span class="line">   0x000000000040107a &lt;+24&gt;:	callq  0x40131b &lt;string_length&gt;</span><br><span class="line">   0x000000000040107f &lt;+29&gt;:	cmp    $0x6,%eax</span><br><span class="line">   0x0000000000401082 &lt;+32&gt;:	je     0x4010d2 &lt;phase_5+112&gt;</span><br><span class="line">   0x0000000000401084 &lt;+34&gt;:	callq  0x40143a &lt;explode_bomb&gt;</span><br><span class="line"></span><br><span class="line">首先可见该函数在栈上申请了32字节空间，接着将fs:0x28地址处的某值放入0x18(%rsp)中，即设置金丝雀值用于栈破坏检测然后调用string_length()函数检查输入字符串字符数目是否为6，非6则炸弹爆炸，由此知应输入字符数目为6.接下来结合</span><br><span class="line">   0x0000000000401082 &lt;+32&gt;:	je     0x4010d2 &lt;phase_5+112&gt;</span><br><span class="line">   </span><br><span class="line">   0x00000000004010d2 &lt;+112&gt;:	mov    $0x0,%eax</span><br><span class="line">   0x00000000004010d7 &lt;+117&gt;:	jmp    0x40108b &lt;phase_5+41&gt;</span><br><span class="line">   </span><br><span class="line">在确认输入字符串字符数为6后，先将%rax值清零，然后进入一段循环</span><br><span class="line">   0x000000000040108b &lt;+41&gt;:	movzbl (%rbx,%rax,1),%ecx</span><br><span class="line">   0x000000000040108f &lt;+45&gt;:	mov    %cl,(%rsp)</span><br><span class="line">   0x0000000000401092 &lt;+48&gt;:	mov    (%rsp),%rdx</span><br><span class="line">   0x0000000000401096 &lt;+52&gt;:	and    $0xf,%edx</span><br><span class="line">   0x0000000000401099 &lt;+55&gt;:	movzbl 0x4024b0(%rdx),%edx</span><br><span class="line">   0x00000000004010a0 &lt;+62&gt;:	mov    %dl,0x10(%rsp,%rax,1)</span><br><span class="line">   0x00000000004010a4 &lt;+66&gt;:	add    $0x1,%rax</span><br><span class="line">   0x00000000004010a8 &lt;+70&gt;:	cmp    $0x6,%rax</span><br><span class="line">   0x00000000004010ac &lt;+74&gt;:	jne    0x40108b &lt;phase_5+41&gt;</span><br><span class="line"></span><br><span class="line">分析知该循环代码依次将我们所输入的六个字符的低四位作为索引，取0x4024b0作为基地址，分六次将索引对应的字符取出存入%rsp + 16 + bias处的栈中，于是我们先反汇编看下0x4024b0地址处存储的信息</span><br><span class="line">(gdb) x &#x2F;s 0x4024b0</span><br><span class="line">0x4024b0 &lt;array.3449&gt;:	&quot;maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?&quot;</span><br><span class="line"></span><br><span class="line">由于索引为我们输入字符的低四位，即索引范围为0 ~ 15，对应该字符串的</span><br><span class="line">	maduiersnfotvbyl</span><br><span class="line"></span><br><span class="line">部分，继续查看phase_5()函数代码</span><br><span class="line">   0x00000000004010ae &lt;+76&gt;:	movb   $0x0,0x16(%rsp)</span><br><span class="line">   0x00000000004010b3 &lt;+81&gt;:	mov    $0x40245e,%esi</span><br><span class="line">   0x00000000004010b8 &lt;+86&gt;:	lea    0x10(%rsp),%rdi</span><br><span class="line">   0x00000000004010bd &lt;+91&gt;:	callq  0x401338 &lt;strings_not_equal&gt;</span><br><span class="line">   0x00000000004010c2 &lt;+96&gt;:	test   %eax,%eax</span><br><span class="line">   0x00000000004010c4 &lt;+98&gt;:	je     0x4010d9 &lt;phase_5+119&gt;</span><br><span class="line">   0x00000000004010c6 &lt;+100&gt;:	callq  0x40143a &lt;explode_bomb&gt;</span><br><span class="line"></span><br><span class="line">string_not_equal在之前的谜题里已见过，易知此段代码作用为将刚才通过索引选出的6个字符与首地址为0x40245e处的字符串进行比较，若不匹配则炸弹爆炸，故查看地址0x40245e处字符串内容</span><br><span class="line">(gdb) x &#x2F;s 0x40245e</span><br><span class="line">0x40245e:	&quot;flyers&quot;</span><br><span class="line"></span><br><span class="line">这六个字符分别对应谜题字符串中的[9, 15, 14, 5, 6, 7]位(从0起计数)，而高四位不做限制，故本题答案不唯一，查阅ascii表易得其中两个答案为&quot;9?&gt;567&quot;, &quot;IONEFG&quot;，其余答案不一一枚举。phase_5()函数最后几行代码用于检测是否发生栈溢出，在此不做更多介绍</span><br></pre></td></tr></table></figure>

<h2 id="phase-6"><a href="#phase-6" class="headerlink" title="phase_6"></a>phase_6</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">反汇编phase_6()函数</span><br><span class="line">   0x00000000004010fc &lt;+8&gt;:		sub    $0x50,%rsp</span><br><span class="line">   0x0000000000401100 &lt;+12&gt;:	mov    %rsp,%r13</span><br><span class="line">   0x0000000000401103 &lt;+15&gt;:	mov    %rsp,%rsi</span><br><span class="line">   0x0000000000401106 &lt;+18&gt;:	callq  0x40145c &lt;read_six_numbers&gt;</span><br><span class="line">   0x000000000040110b &lt;+23&gt;:	mov    %rsp,%r14</span><br><span class="line"></span><br><span class="line">在栈上开辟80字节空间后，将%r13, %rsi, %r14寄存器的值都设为当前栈顶地址。且知本题需输入六个数字</span><br><span class="line">   0x000000000040110e &lt;+26&gt;:	mov    $0x0,%r12d</span><br><span class="line">   0x0000000000401114 &lt;+32&gt;:	mov    %r13,%rbp</span><br><span class="line">   0x0000000000401117 &lt;+35&gt;:	mov    0x0(%r13),%eax</span><br><span class="line">   0x000000000040111b &lt;+39&gt;:	sub    $0x1,%eax</span><br><span class="line">   0x000000000040111e &lt;+42&gt;:	cmp    $0x5,%eax</span><br><span class="line">   0x0000000000401121 &lt;+45&gt;:	jbe    0x401128 &lt;phase_6+52&gt;</span><br><span class="line">   0x0000000000401123 &lt;+47&gt;:	callq  0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000401128 &lt;+52&gt;:	add    $0x1,%r12d</span><br><span class="line">   0x000000000040112c &lt;+56&gt;:	cmp    $0x6,%r12d</span><br><span class="line">   0x0000000000401130 &lt;+60&gt;:	je     0x401153 &lt;phase_6+95&gt;</span><br><span class="line">   0x0000000000401132 &lt;+62&gt;:	mov    %r12d,%ebx</span><br><span class="line">   0x0000000000401135 &lt;+65&gt;:	movslq %ebx,%rax</span><br><span class="line">   0x0000000000401138 &lt;+68&gt;:	mov    (%rsp,%rax,4),%eax</span><br><span class="line">   0x000000000040113b &lt;+71&gt;:	cmp    %eax,0x0(%rbp)</span><br><span class="line">   0x000000000040113e &lt;+74&gt;:	jne    0x401145 &lt;phase_6+81&gt;</span><br><span class="line">   0x0000000000401140 &lt;+76&gt;:	callq  0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000401145 &lt;+81&gt;:	add    $0x1,%ebx</span><br><span class="line">   0x0000000000401148 &lt;+84&gt;:	cmp    $0x5,%ebx</span><br><span class="line">   0x000000000040114b &lt;+87&gt;:	jle    0x401135 &lt;phase_6+65&gt;</span><br><span class="line">   0x000000000040114d &lt;+89&gt;:	add    $0x4,%r13</span><br><span class="line">   0x0000000000401151 &lt;+93&gt;:	jmp    0x401114 &lt;phase_6+32&gt;</span><br><span class="line"></span><br><span class="line">分析知本谜题六个输入数字均小于等于6，且六个数字各不相同</span><br><span class="line">   0x0000000000401153 &lt;+95&gt;:	lea    0x18(%rsp),%rsi</span><br><span class="line">   0x0000000000401158 &lt;+100&gt;:	mov    %r14,%rax</span><br><span class="line">   0x000000000040115b &lt;+103&gt;:	mov    $0x7,%ecx</span><br><span class="line">   0x0000000000401160 &lt;+108&gt;:	mov    %ecx,%edx</span><br><span class="line">   0x0000000000401162 &lt;+110&gt;:	sub    (%rax),%edx</span><br><span class="line">   0x0000000000401164 &lt;+112&gt;:	mov    %edx,(%rax)</span><br><span class="line">   0x0000000000401166 &lt;+114&gt;:	add    $0x4,%rax</span><br><span class="line">   0x000000000040116a &lt;+118&gt;:	cmp    %rsi,%rax</span><br><span class="line">   0x000000000040116d &lt;+121&gt;:	jne    0x401160 &lt;phase_6+108&gt;</span><br><span class="line"></span><br><span class="line">设六个输入按顺序为a[0]至a[5]，上述循环令a[i] &#x3D; 7 - a[i]</span><br><span class="line">   0x000000000040116f &lt;+123&gt;:	mov    $0x0,%esi</span><br><span class="line">   0x0000000000401174 &lt;+128&gt;:	jmp    0x401197 &lt;phase_6+163&gt;</span><br><span class="line">   0x0000000000401176 &lt;+130&gt;:	mov    0x8(%rdx),%rdx</span><br><span class="line">   0x000000000040117a &lt;+134&gt;:	add    $0x1,%eax</span><br><span class="line">   0x000000000040117d &lt;+137&gt;:	cmp    %ecx,%eax</span><br><span class="line">   0x000000000040117f &lt;+139&gt;:	jne    0x401176 &lt;phase_6+130&gt;</span><br><span class="line">   0x0000000000401181 &lt;+141&gt;:	jmp    0x401188 &lt;phase_6+148&gt;</span><br><span class="line">   0x0000000000401183 &lt;+143&gt;:	mov    $0x6032d0,%edx</span><br><span class="line">   0x0000000000401188 &lt;+148&gt;:	mov    %rdx,0x20(%rsp,%rsi,2)</span><br><span class="line">   0x000000000040118d &lt;+153&gt;:	add    $0x4,%rsi</span><br><span class="line">   0x0000000000401191 &lt;+157&gt;:	cmp    $0x18,%rsi</span><br><span class="line">   0x0000000000401195 &lt;+161&gt;:	je     0x4011ab &lt;phase_6+183&gt;</span><br><span class="line">   0x0000000000401197 &lt;+163&gt;:	mov    (%rsp,%rsi,1),%ecx</span><br><span class="line">   0x000000000040119a &lt;+166&gt;:	cmp    $0x1,%ecx</span><br><span class="line">   0x000000000040119d &lt;+169&gt;:	jle    0x401183 &lt;phase_6+143&gt;</span><br><span class="line">   0x000000000040119f &lt;+171&gt;:	mov    $0x1,%eax</span><br><span class="line">   0x00000000004011a4 &lt;+176&gt;:	mov    $0x6032d0,%edx</span><br><span class="line">   0x00000000004011a9 &lt;+181&gt;:	jmp    0x401176 &lt;phase_6+130&gt;</span><br><span class="line"></span><br><span class="line">分析知有一链表首地址为0x6032d0，该链表一个结点16字节，后8字节用于存放指向下一个结点的指针，于是顺藤摸瓜找出该链表所有结点，设结点按顺序分别为b[0]至b[5]，上述代码作用为将a[i] - 1对应的结点地址放于%rsp + 32为基地址的栈中(e.g. 假设a[0] &#x3D; 3，则将b[2]放于(%rsp + 32 + 0 * 8)处空间中)</span><br><span class="line">(gdb) x &#x2F;16xb 0x6032d0</span><br><span class="line">0x6032d0 &lt;node1&gt;:	0x4c	0x01	0x00	0x00	0x01	0x00	0x00	0x00</span><br><span class="line">0x6032d8 &lt;node1+8&gt;:	0xe0	0x32	0x60	0x00	0x00	0x00	0x00	0x00</span><br><span class="line">(gdb) x &#x2F;16xb 0x6032e0</span><br><span class="line">0x6032e0 &lt;node2&gt;:	0xa8	0x00	0x00	0x00	0x02	0x00	0x00	0x00</span><br><span class="line">0x6032e8 &lt;node2+8&gt;:	0xf0	0x32	0x60	0x00	0x00	0x00	0x00	0x00</span><br><span class="line">(gdb) x &#x2F;16xb 0x6032f0</span><br><span class="line">0x6032f0 &lt;node3&gt;:	0x9c	0x03	0x00	0x00	0x03	0x00	0x00	0x00</span><br><span class="line">0x6032f8 &lt;node3+8&gt;:	0x00	0x33	0x60	0x00	0x00	0x00	0x00	0x00</span><br><span class="line">(gdb) x &#x2F;16xb 0x603300</span><br><span class="line">0x603300 &lt;node4&gt;:	0xb3	0x02	0x00	0x00	0x04	0x00	0x00	0x00</span><br><span class="line">0x603308 &lt;node4+8&gt;:	0x10	0x33	0x60	0x00	0x00	0x00	0x00	0x00</span><br><span class="line">(gdb) x &#x2F;16xb 0x603310</span><br><span class="line">0x603310 &lt;node5&gt;:	0xdd	0x01	0x00	0x00	0x05	0x00	0x00	0x00</span><br><span class="line">0x603318 &lt;node5+8&gt;:	0x20	0x33	0x60	0x00	0x00	0x00	0x00	0x00</span><br><span class="line">(gdb) x &#x2F;16xb 0x603320</span><br><span class="line">0x603320 &lt;node6&gt;:	0xbb	0x01	0x00	0x00	0x06	0x00	0x00	0x00</span><br><span class="line">0x603328 &lt;node6+8&gt;:	0x00	0x00	0x00	0x00	0x00	0x00	0x00</span><br><span class="line"></span><br><span class="line">继续阅读</span><br><span class="line">   0x00000000004011ab &lt;+183&gt;:	mov    0x20(%rsp),%rbx</span><br><span class="line">   0x00000000004011b0 &lt;+188&gt;:	lea    0x28(%rsp),%rax</span><br><span class="line">   0x00000000004011b5 &lt;+193&gt;:	lea    0x50(%rsp),%rsi</span><br><span class="line">   0x00000000004011ba &lt;+198&gt;:	mov    %rbx,%rcx</span><br><span class="line">   0x00000000004011bd &lt;+201&gt;:	mov    (%rax),%rdx</span><br><span class="line">   0x00000000004011c0 &lt;+204&gt;:	mov    %rdx,0x8(%rcx)</span><br><span class="line">   0x00000000004011c4 &lt;+208&gt;:	add    $0x8,%rax</span><br><span class="line">   0x00000000004011c8 &lt;+212&gt;:	cmp    %rsi,%rax</span><br><span class="line">   0x00000000004011cb &lt;+215&gt;:	je     0x4011d2 &lt;phase_6+222&gt;</span><br><span class="line">   0x00000000004011cd &lt;+217&gt;:	mov    %rdx,%rcx</span><br><span class="line">   0x00000000004011d0 &lt;+220&gt;:	jmp    0x4011bd &lt;phase_6+201&gt;</span><br><span class="line"></span><br><span class="line">上述代码将结点按新的顺序链成链表</span><br><span class="line">   0x00000000004011d2 &lt;+222&gt;:	movq   $0x0,0x8(%rdx)</span><br><span class="line">   0x00000000004011da &lt;+230&gt;:	mov    $0x5,%ebp</span><br><span class="line">   0x00000000004011df &lt;+235&gt;:	mov    0x8(%rbx),%rax</span><br><span class="line">   0x00000000004011e3 &lt;+239&gt;:	mov    (%rax),%eax</span><br><span class="line">   0x00000000004011e5 &lt;+241&gt;:	cmp    %eax,(%rbx)</span><br><span class="line">   0x00000000004011e7 &lt;+243&gt;:	jge    0x4011ee &lt;phase_6+250&gt;</span><br><span class="line">   0x00000000004011e9 &lt;+245&gt;:	callq  0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x00000000004011ee &lt;+250&gt;:	mov    0x8(%rbx),%rbx</span><br><span class="line">   0x00000000004011f2 &lt;+254&gt;:	sub    $0x1,%ebp</span><br><span class="line">   0x00000000004011f5 &lt;+257&gt;:	jne    0x4011df &lt;phase_6+235&gt;</span><br><span class="line"></span><br><span class="line">分析知正确的结点值应从高到低排列，又因比较结点值时使用的是%eax寄存器，故比较的是各结点前四字节的值，即根据我们输入的六个不同数值a[0]至a[5]，分别取a[i] &#x3D; 7 - a[i]，再用新的a[i]值将原链表结点顺序重排得新链表，保证新链表的结点值为从高至低排列。原各结点值如下表</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="center">node1</th>
<th align="center">node2</th>
<th align="center">node3</th>
<th align="center">node4</th>
<th align="center">node5</th>
<th align="center">node6</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0x14c</td>
<td align="center">0xa8</td>
<td align="center">0x39c</td>
<td align="center">0x2b3</td>
<td align="center">0x1dd</td>
<td align="center">0x1bb</td>
</tr>
</tbody></table>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">按从大到小排列为 [node3, node4, node5, node6, node1, node2]</span><br><span class="line">	a[<span class="number">0</span>]新 - <span class="number">1</span> = <span class="number">3</span></span><br><span class="line">	a[<span class="number">1</span>]新 - <span class="number">1</span> = <span class="number">4</span></span><br><span class="line">	...</span><br><span class="line">	a[<span class="number">5</span>]新 - <span class="number">1</span> = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">而</span><br><span class="line">	a[i]新 = <span class="number">7</span> - a[i]旧</span><br><span class="line"></span><br><span class="line">故</span><br><span class="line">	a旧 = [<span class="number">4</span>, <span class="number">3</span> ,<span class="number">2</span> ,<span class="number">1</span> ,<span class="number">6</span>, <span class="number">5</span>]</span><br><span class="line"></span><br><span class="line">即应输入六数分别为[<span class="number">4</span>, <span class="number">3</span> ,<span class="number">2</span> ,<span class="number">1</span> ,<span class="number">6</span>, <span class="number">5</span>]</span><br></pre></td></tr></table></figure>

<h2 id="secret-phase"><a href="#secret-phase" class="headerlink" title="secret_phase"></a>secret_phase</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line">反汇编phase_defused()函数</span><br><span class="line">   0x00000000004015c4 &lt;+0&gt;:		sub    $0x78,%rsp</span><br><span class="line">   0x00000000004015c8 &lt;+4&gt;:		mov    %fs:0x28,%rax</span><br><span class="line">   0x00000000004015d1 &lt;+13&gt;:	mov    %rax,0x68(%rsp)</span><br><span class="line">   0x00000000004015d6 &lt;+18&gt;:	xor    %eax,%eax</span><br><span class="line">   0x00000000004015d8 &lt;+20&gt;:	cmpl   $0x6,0x202181(%rip)        # 0x603760 &lt;num_input_strings&gt;</span><br><span class="line">   0x00000000004015df &lt;+27&gt;:	jne    0x40163f &lt;phase_defused+123&gt;</span><br><span class="line"></span><br><span class="line">发现只有六个谜题都破解后才会触发隐藏谜题，继续向下分析</span><br><span class="line">   0x00000000004015e1 &lt;+29&gt;:	lea    0x10(%rsp),%r8</span><br><span class="line">   0x00000000004015e6 &lt;+34&gt;:	lea    0xc(%rsp),%rcx</span><br><span class="line">   0x00000000004015eb &lt;+39&gt;:	lea    0x8(%rsp),%rdx</span><br><span class="line">   0x00000000004015f0 &lt;+44&gt;:	mov    $0x402619,%esi</span><br><span class="line">   0x00000000004015f5 &lt;+49&gt;:	mov    $0x603870,%edi</span><br><span class="line">   0x00000000004015fa &lt;+54&gt;:	callq  0x400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">   0x00000000004015ff &lt;+59&gt;:	cmp    $0x3,%eax</span><br><span class="line">   0x0000000000401602 &lt;+62&gt;:	jne    0x401635 &lt;phase_defused+113&gt;</span><br><span class="line"></span><br><span class="line">发现函数调用首地址为0x400bf0的sscanf()函数读入数据，查看%0x402619处内容，得</span><br><span class="line">(gdb) x &#x2F;s 0x402619</span><br><span class="line">0x402619:	&quot;%d %d %s&quot;</span><br><span class="line"></span><br><span class="line">故知一次读入两个int型数据和一个字符串，分别存入0x8(%rsp), 0xc(%rsp), 0x10(%rsp)中</span><br><span class="line">   0x0000000000401604 &lt;+64&gt;:	mov    $0x402622,%esi</span><br><span class="line">   0x0000000000401609 &lt;+69&gt;:	lea    0x10(%rsp),%rdi</span><br><span class="line">   0x000000000040160e &lt;+74&gt;:	callq  0x401338 &lt;strings_not_equal&gt;</span><br><span class="line">   0x0000000000401613 &lt;+79&gt;:	test   %eax,%eax</span><br><span class="line">   0x0000000000401615 &lt;+81&gt;:	jne    0x401635 &lt;phase_defused+113&gt;</span><br><span class="line"></span><br><span class="line">接着phase_defused()调用strings_not_euqal()检测我们输入的字符串与首地址为0x402622处的模式串是否匹配，于是查看该地址处的字符串得正解</span><br><span class="line">(gdb) x &#x2F;s 0x402622</span><br><span class="line">0x402622:	&quot;DrEvil&quot;</span><br><span class="line"></span><br><span class="line">需注意，phase_defused()函数并未调用诸如read_line()等函数读取输入，而是直接默认从0x603870地址处读取数据。而前六个谜题每个都调用了一次read_line()函数，再通过</span><br><span class="line">	mov %rax, %rdi</span><br><span class="line"></span><br><span class="line">指令将输入的数据传给相应函数，于是猜测0x603870为main()函数中某次调用read_line()参数获得用户输入后传给phase_x()函数的地址，检查六次调用read_line()后read_line()传送给phase_x()函数的地址，得六个地址分别为</span><br><span class="line">	0x603780</span><br><span class="line">	0x6037d0</span><br><span class="line">	0x603820</span><br><span class="line">	0x603870</span><br><span class="line">	0x6038c0</span><br><span class="line">	0x603910</span><br><span class="line"></span><br><span class="line">知0x603870为第四次read_line()后传递给phase_4()的输入数据的首地址，而第四个谜题需输入两个int型变量，因此只需在第四题的答案后面加上字符串&quot;DrEvil&quot;即可在六个谜题结束后触发隐藏谜题，继续分析</span><br><span class="line">   0x0000000000401617 &lt;+83&gt;:	mov    $0x4024f8,%edi</span><br><span class="line">   0x000000000040161c &lt;+88&gt;:	callq  0x400b10 &lt;puts@plt&gt;</span><br><span class="line">   0x0000000000401621 &lt;+93&gt;:	mov    $0x402520,%edi</span><br><span class="line">   0x0000000000401626 &lt;+98&gt;:	callq  0x400b10 &lt;puts@plt&gt;</span><br><span class="line">   0x000000000040162b &lt;+103&gt;:	mov    $0x0,%eax</span><br><span class="line">   0x0000000000401630 &lt;+108&gt;:	callq  0x401242 &lt;secret_phase&gt;</span><br><span class="line">   0x0000000000401635 &lt;+113&gt;:	mov    $0x402558,%edi</span><br><span class="line">   0x000000000040163a &lt;+118&gt;:	callq  0x400b10 &lt;puts@plt&gt;</span><br><span class="line">   0x000000000040163f &lt;+123&gt;:	mov    0x68(%rsp),%rax</span><br><span class="line">   0x0000000000401644 &lt;+128&gt;:	xor    %fs:0x28,%rax</span><br><span class="line">   0x000000000040164d &lt;+137&gt;:	je     0x401654 &lt;phase_defused+144&gt;</span><br><span class="line">   0x000000000040164f &lt;+139&gt;:	callq  0x400b30 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">   0x0000000000401654 &lt;+144&gt;:	add    $0x78,%rsp</span><br><span class="line">   0x0000000000401658 &lt;+148&gt;:	retq   </span><br><span class="line"></span><br><span class="line">函数输出两字符串，调用secret_phase()函数，再输出一字符串，检查栈是否溢出，结束。于是接下来分析secret_phase()函数</span><br><span class="line">   0x0000000000401242 &lt;+0&gt;:		push   %rbx</span><br><span class="line">   0x0000000000401243 &lt;+1&gt;:		callq  0x40149e &lt;read_line&gt;</span><br><span class="line">   0x0000000000401248 &lt;+6&gt;:		mov    $0xa,%edx</span><br><span class="line">   0x000000000040124d &lt;+11&gt;:	mov    $0x0,%esi</span><br><span class="line">   0x0000000000401252 &lt;+16&gt;:	mov    %rax,%rdi</span><br><span class="line">   0x0000000000401255 &lt;+19&gt;:	callq  0x400bd0 &lt;strtol@plt&gt;</span><br><span class="line">   0x000000000040125a &lt;+24&gt;:	mov    %rax,%rbx</span><br><span class="line">   0x000000000040125d &lt;+27&gt;:	lea    -0x1(%rax),%eax</span><br><span class="line">   0x0000000000401260 &lt;+30&gt;:	cmp    $0x3e8,%eax</span><br><span class="line">   0x0000000000401265 &lt;+35&gt;:	jbe    0x40126c &lt;secret_phase+42&gt;</span><br><span class="line">   0x0000000000401267 &lt;+37&gt;:	callq  0x40143a &lt;explode_bomb&gt;</span><br><span class="line"></span><br><span class="line">通过调用read_line()函数读入字符串，并调用strtol()函数将其转换为十进制数字，且该数字应小于等于0x3e9，否则炸弹爆炸</span><br><span class="line">   0x000000000040126c &lt;+42&gt;:	mov    %ebx,%esi</span><br><span class="line">   0x000000000040126e &lt;+44&gt;:	mov    $0x6030f0,%edi</span><br><span class="line">   0x0000000000401273 &lt;+49&gt;:	callq  0x401204 &lt;fun7&gt;</span><br><span class="line">   0x0000000000401278 &lt;+54&gt;:	cmp    $0x2,%eax</span><br><span class="line">   0x000000000040127b &lt;+57&gt;:	je     0x401282 &lt;secret_phase+64&gt;</span><br><span class="line">   0x000000000040127d &lt;+59&gt;:	callq  0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000401282 &lt;+64&gt;:	mov    $0x402438,%edi</span><br><span class="line">   0x0000000000401287 &lt;+69&gt;:	callq  0x400b10 &lt;puts@plt&gt;</span><br><span class="line">   0x000000000040128c &lt;+74&gt;:	callq  0x4015c4 &lt;phase_defused&gt;</span><br><span class="line">   0x0000000000401291 &lt;+79&gt;:	pop    %rbx</span><br><span class="line">   0x0000000000401292 &lt;+80&gt;:	retq   </span><br><span class="line"></span><br><span class="line">函数将地址0x6030f0送入%rdi后，调用首地址为0x401204的fun7()函数，且知该函数必须返回数值2，反汇编fun7()函数进行分析</span><br><span class="line">   0x0000000000401204 &lt;+0&gt;:		sub    $0x8,%rsp</span><br><span class="line">   0x0000000000401208 &lt;+4&gt;:		test   %rdi,%rdi</span><br><span class="line">   0x000000000040120b &lt;+7&gt;:		je     0x401238 &lt;fun7+52&gt;</span><br><span class="line">   0x000000000040120d &lt;+9&gt;:		mov    (%rdi),%edx</span><br><span class="line">   0x000000000040120f &lt;+11&gt;:	cmp    %esi,%edx</span><br><span class="line">   0x0000000000401211 &lt;+13&gt;:	jle    0x401220 &lt;fun7+28&gt;</span><br><span class="line">   0x0000000000401213 &lt;+15&gt;:	mov    0x8(%rdi),%rdi</span><br><span class="line">   0x0000000000401217 &lt;+19&gt;:	callq  0x401204 &lt;fun7&gt;</span><br><span class="line">   0x000000000040121c &lt;+24&gt;:	add    %eax,%eax</span><br><span class="line">   0x000000000040121e &lt;+26&gt;:	jmp    0x40123d &lt;fun7+57&gt;</span><br><span class="line">   0x0000000000401220 &lt;+28&gt;:	mov    $0x0,%eax</span><br><span class="line">   0x0000000000401225 &lt;+33&gt;:	cmp    %esi,%edx</span><br><span class="line">   0x0000000000401227 &lt;+35&gt;:	je     0x40123d &lt;fun7+57&gt;</span><br><span class="line">   0x0000000000401229 &lt;+37&gt;:	mov    0x10(%rdi),%rdi</span><br><span class="line">   0x000000000040122d &lt;+41&gt;:	callq  0x401204 &lt;fun7&gt;</span><br><span class="line">   0x0000000000401232 &lt;+46&gt;:	lea    0x1(%rax,%rax,1),%eax</span><br><span class="line">   0x0000000000401236 &lt;+50&gt;:	jmp    0x40123d &lt;fun7+57&gt;</span><br><span class="line">   0x0000000000401238 &lt;+52&gt;:	mov    $0xffffffff,%eax</span><br><span class="line">   0x000000000040123d &lt;+57&gt;:	add    $0x8,%rsp</span><br><span class="line">   0x0000000000401241 &lt;+61&gt;:	retq   </span><br><span class="line"></span><br><span class="line">尝试将该函数反编译为c代码风格</span><br><span class="line">fun7(x, y)</span><br><span class="line">x in %rdi, y in %rsi, p for %rdx</span><br><span class="line">	if (x &#x3D;&#x3D; 0) return -1;</span><br><span class="line">	p &#x3D; *x;</span><br><span class="line">	if (p &lt;&#x3D; y) &#123;</span><br><span class="line">		if (p &#x3D;&#x3D; y) return 0;</span><br><span class="line">		return 2 * fun7(x, y) + 1;</span><br><span class="line">	&#125;</span><br><span class="line">	x &#x3D; *(x + 8);</span><br><span class="line">	return 2 * fun7(x, y);</span><br><span class="line">	</span><br><span class="line">初次调用fun7()函数时，x值为0x6030f0, y值为我们输入的一个字符串转换所得数值，结合0x6030f0内存地址的值等，可以推出一个答案y值为22(0x16).在我通过此方法推出一个答案值后，参考他人题解，知0x6030f0为一二叉树根节点地址，该数每个结点含一个值和两个指向左右儿子的指针</span><br><span class="line">(gdb) x &#x2F;80a 0x6030f0</span><br><span class="line">0x6030f0 &lt;n1&gt;:	0x24	0x603110 &lt;n21&gt;</span><br><span class="line">0x603100 &lt;n1+16&gt;:	0x603130 &lt;n22&gt;	0x0</span><br><span class="line">0x603110 &lt;n21&gt;:	0x8	0x603190 &lt;n31&gt;</span><br><span class="line">0x603120 &lt;n21+16&gt;:	0x603150 &lt;n32&gt;	0x0</span><br><span class="line">0x603130 &lt;n22&gt;:	0x32	0x603170 &lt;n33&gt;</span><br><span class="line">0x603140 &lt;n22+16&gt;:	0x6031b0 &lt;n34&gt;	0x0</span><br><span class="line">0x603150 &lt;n32&gt;:	0x16	0x603270 &lt;n43&gt;</span><br><span class="line">0x603160 &lt;n32+16&gt;:	0x603230 &lt;n44&gt;	0x0</span><br><span class="line">0x603170 &lt;n33&gt;:	0x2d	0x6031d0 &lt;n45&gt;</span><br><span class="line">0x603180 &lt;n33+16&gt;:	0x603290 &lt;n46&gt;	0x0</span><br><span class="line">0x603190 &lt;n31&gt;:	0x6	0x6031f0 &lt;n41&gt;</span><br><span class="line">0x6031a0 &lt;n31+16&gt;:	0x603250 &lt;n42&gt;	0x0</span><br><span class="line">0x6031b0 &lt;n34&gt;:	0x6b	0x603210 &lt;n47&gt;</span><br><span class="line">0x6031c0 &lt;n34+16&gt;:	0x6032b0 &lt;n48&gt;	0x0</span><br><span class="line"></span><br><span class="line">由以上信息可构建树为</span><br></pre></td></tr></table></figure>

<img src="/2021/04/05/CSAPP-Labs/bomblab_tree.png" class>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">故可的答案为22(0x16),</span> <span class="number">20</span><span class="string">(0x14).</span></span><br><span class="line"></span><br><span class="line"><span class="string">至此，全部谜题破解</span></span><br><span class="line"><span class="string">fez@LAPTOP-MB5DL415:/mnt/d/repositories/CSAPP/Labs/BombLab$</span> <span class="string">cat</span> <span class="string">phases.txt</span> </span><br><span class="line"><span class="string">Border</span> <span class="string">relations</span> <span class="string">with</span> <span class="string">Canada</span> <span class="string">have</span> <span class="string">never</span> <span class="string">been</span> <span class="string">better.</span></span><br><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">4</span> <span class="number">8</span> <span class="number">16</span> <span class="number">32</span></span><br><span class="line"><span class="number">0</span> <span class="number">207</span></span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="string">DrEvil</span></span><br><span class="line"><span class="string">IONEFG</span></span><br><span class="line"><span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span> <span class="number">6</span> <span class="number">5</span></span><br><span class="line"><span class="number">20</span></span><br><span class="line"><span class="string">fez@LAPTOP-MB5DL415:/mnt/d/repositories/CSAPP/Labs/BombLab$</span> <span class="string">./bomb</span> <span class="string">phases.txt</span> </span><br><span class="line"><span class="string">Welcome</span> <span class="string">to</span> <span class="string">my</span> <span class="string">fiendish</span> <span class="string">little</span> <span class="string">bomb.</span> <span class="string">You</span> <span class="string">have</span> <span class="number">6</span> <span class="string">phases</span> <span class="string">with</span></span><br><span class="line"><span class="string">which</span> <span class="string">to</span> <span class="string">blow</span> <span class="string">yourself</span> <span class="string">up.</span> <span class="string">Have</span> <span class="string">a</span> <span class="string">nice</span> <span class="string">day!</span></span><br><span class="line"><span class="string">Phase</span> <span class="number">1</span> <span class="string">defused.</span> <span class="string">How</span> <span class="string">about</span> <span class="string">the</span> <span class="string">next</span> <span class="string">one?</span></span><br><span class="line"><span class="string">That&#x27;s</span> <span class="string">number</span> <span class="number">2</span><span class="string">.</span>  <span class="string">Keep</span> <span class="string">going!</span></span><br><span class="line"><span class="string">Halfway</span> <span class="string">there!</span></span><br><span class="line"><span class="string">So</span> <span class="string">you</span> <span class="string">got</span> <span class="string">that</span> <span class="string">one.</span>  <span class="string">Try</span> <span class="string">this</span> <span class="string">one.</span></span><br><span class="line"><span class="string">Good</span> <span class="string">work!</span>  <span class="string">On</span> <span class="string">to</span> <span class="string">the</span> <span class="string">next...</span></span><br><span class="line"><span class="string">Curses,</span> <span class="string">you&#x27;ve</span> <span class="string">found</span> <span class="string">the</span> <span class="string">secret</span> <span class="string">phase!</span></span><br><span class="line"><span class="string">But</span> <span class="string">finding</span> <span class="string">it</span> <span class="string">and</span> <span class="string">solving</span> <span class="string">it</span> <span class="string">are</span> <span class="string">quite</span> <span class="string">different...</span></span><br><span class="line"><span class="string">Wow!</span> <span class="string">You&#x27;ve</span> <span class="string">defused</span> <span class="string">the</span> <span class="string">secret</span> <span class="string">stage!</span></span><br><span class="line"><span class="string">Congratulations!</span> <span class="string">You&#x27;ve</span> <span class="string">defused</span> <span class="string">the</span> <span class="string">bomb!</span></span><br><span class="line">																<span class="number">2021</span><span class="string">/7/27</span></span><br><span class="line">																<span class="number">21</span><span class="string">:16</span></span><br></pre></td></tr></table></figure>

<h1 id="ArchitectureLab"><a href="#ArchitectureLab" class="headerlink" title="ArchitectureLab"></a>ArchitectureLab</h1><h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><p>这个实验无疑是目前已做三个实验里花费我最多精力的，很可能也是所有实验里最花费精力的一个。如某人所言，本实验实验环境的搭建甚至比实验内容本身还要困难。搭建环境的过程不知掉了多少头发，可谓是十分痛苦了，令我一度想要放弃本实验。现在磕磕绊绊把实验做完，回顾全过程，记录下实验中遇到的一些难点，即是反思回味，也希望能帮助同我当初一样面对这般那般的问题而一筹莫展的朋友</p>
<p>我的实验环境为WSL版的Ubuntu，由于没有安装相关库，模拟器不支持GUI界面，因此在解压sim包后，将sim目录下的Makefile文件中涉及GUI的三行注释掉</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#GUIMODE=-DHAS_GUI</span></span><br><span class="line"><span class="comment">#TKLIBS=-L/usr/lib -ltk -ltcl</span></span><br><span class="line"><span class="comment">#TKINC=-isystem /usr/include</span></span><br></pre></td></tr></table></figure>

<p>注释GUI相关东西是我从别人博客学到的，在整个实验过程中我也没有使用过GUI。我自己也尝试过安装tk与tcl，但是如果安装版本是8.6及以上，仍不能正常使用，<strong>若想要在本实验中使用GUI，tk与tcl必须安装为8.5版本及以下</strong>，接着尝试</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unix&gt; <span class="built_in">make</span> clean</span><br><span class="line">unix&gt; <span class="built_in">make</span></span><br></pre></td></tr></table></figure>

<p>如果报错信息包含关键词$flex$和$bison$，可能是没有安装相关依赖软件，尝试安装</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unix&gt; sudo apt-<span class="builtin-name">get</span> install flex</span><br><span class="line">unix&gt; sudo apt-<span class="builtin-name">get</span> install bison</span><br></pre></td></tr></table></figure>

<p>当在sim目录及其子目录中任意一个进行</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unix&gt; <span class="built_in">make</span></span><br></pre></td></tr></table></figure>

<p>时显示某.c文件报以下错误</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">build fails <span class="keyword">with</span> tcl <span class="number">8.6</span>: <span class="keyword">error</span>: tcl_interp has <span class="keyword">no</span> <span class="keyword">member</span> named <span class="keyword">result</span></span><br></pre></td></tr></table></figure>

<p>请参考<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/66291922/tk-h-looks-for-tcl-h-in-usr-include-but-tcl-h-is-in-usr-include-tcl-i-dont-h">这篇文章</a>查看解决方案</p>
<h2 id="Part-A"><a href="#Part-A" class="headerlink" title="Part A"></a>Part A</h2><p>这一部分内容较为简单，正如lab介绍文档中所言，part A部分是为后续实验准备的热身运动</p>
<h3 id="sum-ys"><a href="#sum-ys" class="headerlink" title="sum.ys"></a>sum.ys</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"># Execution begins at address 0</span><br><span class="line">	.pos 0</span><br><span class="line">	irmovq stack, %rsp</span><br><span class="line">	call main</span><br><span class="line">	halt</span><br><span class="line"></span><br><span class="line"># Sample linked list</span><br><span class="line">	.align 8</span><br><span class="line">list:</span><br><span class="line">	ele1:</span><br><span class="line">		.quad 0x00a</span><br><span class="line">		.quad ele2</span><br><span class="line">	ele2:</span><br><span class="line">		.quad 0x0b0</span><br><span class="line">		.quad ele3</span><br><span class="line">	ele3:</span><br><span class="line">		.quad 0xc00</span><br><span class="line">		.quad 0</span><br><span class="line"></span><br><span class="line">main:</span><br><span class="line">	irmovq list, %rdi</span><br><span class="line">	call sum_list</span><br><span class="line">	ret</span><br><span class="line"></span><br><span class="line"># long sum_list(list_ptr ls)</span><br><span class="line"># ls in %rdi</span><br><span class="line">sum_list:</span><br><span class="line">	irmovq $8, %r8</span><br><span class="line">	xorq %rax, %rax</span><br><span class="line">test:</span><br><span class="line">	andq %rdi, %rdi</span><br><span class="line">	je done</span><br><span class="line">	mrmovq (%rdi), %r9</span><br><span class="line">	addq %r9, %rax</span><br><span class="line">	addq %r8, %rdi</span><br><span class="line">	mrmovq (%rdi), %rdi</span><br><span class="line">	jmp test</span><br><span class="line">done:</span><br><span class="line">	ret</span><br><span class="line"></span><br><span class="line">	.pos 0x200</span><br><span class="line">stack:</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ArchitectureLab/sim/misc&gt; make sum.yo</span><br><span class="line">./yas sum.ys</span><br><span class="line">ArchitectureLab/sim/misc&gt; ./yis sum.yo</span><br><span class="line">Stopped <span class="keyword">in</span> <span class="number">32</span> steps at PC = <span class="number">0x13</span>.  Status <span class="string">&#x27;HLT&#x27;</span>, CC Z=<span class="number">1</span> S=<span class="number">0</span> O=<span class="number">0</span></span><br><span class="line">Changes to registers:</span><br><span class="line">%rax:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000cba</span></span><br><span class="line">%rsp:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000200</span></span><br><span class="line">%r8:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000008</span></span><br><span class="line">%r9:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000c00</span></span><br><span class="line"></span><br><span class="line">Changes to memory:</span><br><span class="line"><span class="number">0x01f0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x000000000000005b</span></span><br><span class="line"><span class="number">0x01f8</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000013</span></span><br></pre></td></tr></table></figure>

<h3 id="rsum-ys"><a href="#rsum-ys" class="headerlink" title="rsum.ys"></a>rsum.ys</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"># Execution begins at address 0</span><br><span class="line">	.pos 0</span><br><span class="line">	irmovq stack, %rsp</span><br><span class="line">	call main</span><br><span class="line">	halt</span><br><span class="line"></span><br><span class="line"># Sample linked list</span><br><span class="line">	.align 8</span><br><span class="line">list:</span><br><span class="line">	ele1:</span><br><span class="line">		.quad 0x00a</span><br><span class="line">		.quad ele2</span><br><span class="line">	ele2:</span><br><span class="line">		.quad 0x0b0</span><br><span class="line">		.quad ele3</span><br><span class="line">	ele3:</span><br><span class="line">		.quad 0xc00</span><br><span class="line">		.quad 0</span><br><span class="line"></span><br><span class="line">main:</span><br><span class="line">	irmovq list, %rdi</span><br><span class="line">	call rsum_list</span><br><span class="line">	ret</span><br><span class="line"></span><br><span class="line"># long rsum_list(list_ptr ls)</span><br><span class="line"># ls in %rdi</span><br><span class="line">rsum_list:</span><br><span class="line">	irmovq $8, %r8</span><br><span class="line">	xorq %rax, %rax</span><br><span class="line">	andq %rdi, %rdi</span><br><span class="line">	je null_pointer</span><br><span class="line">	mrmovq (%rdi), %rbx</span><br><span class="line">	pushq %rbx</span><br><span class="line">	addq %r8, %rdi</span><br><span class="line">	mrmovq (%rdi), %rdi</span><br><span class="line">	call rsum_list</span><br><span class="line">	popq %rbx</span><br><span class="line">	addq %rbx, %rax</span><br><span class="line">null_pointer:</span><br><span class="line">	ret</span><br><span class="line"></span><br><span class="line">	.pos 0x200</span><br><span class="line">stack:</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ArchitectureLab/sim/misc&gt; make rsum.yo</span><br><span class="line">./yas rsum.ys</span><br><span class="line">ArchitectureLab/sim/misc&gt; ./yis rsum.yo</span><br><span class="line">Stopped <span class="keyword">in</span> <span class="number">47</span> steps at PC = <span class="number">0x13</span>.  Status <span class="string">&#x27;HLT&#x27;</span>, CC Z=<span class="number">0</span> S=<span class="number">0</span> O=<span class="number">0</span></span><br><span class="line">Changes to registers:</span><br><span class="line">%rax:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000cba</span></span><br><span class="line">%rbx:	<span class="number">0x0000000000000000</span>	<span class="number">0x000000000000000a</span></span><br><span class="line">%rsp:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000200</span></span><br><span class="line">%r8:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000008</span></span><br><span class="line"></span><br><span class="line">Changes to memory:</span><br><span class="line"><span class="number">0x01c0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000094</span></span><br><span class="line"><span class="number">0x01c8</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000c00</span></span><br><span class="line"><span class="number">0x01d0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000094</span></span><br><span class="line"><span class="number">0x01d8</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x00000000000000b0</span></span><br><span class="line"><span class="number">0x01e0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000094</span></span><br><span class="line"><span class="number">0x01e8</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x000000000000000a</span></span><br><span class="line"><span class="number">0x01f0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x000000000000005b</span></span><br><span class="line"><span class="number">0x01f8</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000013</span></span><br></pre></td></tr></table></figure>

<h3 id="copy-ys"><a href="#copy-ys" class="headerlink" title="copy.ys"></a>copy.ys</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"># Execution begins at address 0</span><br><span class="line">	.pos 0</span><br><span class="line">	irmovq stack, %rsp</span><br><span class="line">	call main</span><br><span class="line">	halt</span><br><span class="line"></span><br><span class="line">	.align 8</span><br><span class="line"># Source block</span><br><span class="line">src:</span><br><span class="line">	.quad 0x00a</span><br><span class="line">	.quad 0x0b0</span><br><span class="line">	.quad 0xc00</span><br><span class="line"></span><br><span class="line"># Destination block</span><br><span class="line">dest:</span><br><span class="line">	.quad 0x111</span><br><span class="line">	.quad 0x222</span><br><span class="line">	.quad 0x333</span><br><span class="line"></span><br><span class="line">main:</span><br><span class="line">	irmovq src, %rdi</span><br><span class="line">	irmovq dest, %rsi</span><br><span class="line">	irmovq $3, %rdx</span><br><span class="line">	call copy_block</span><br><span class="line">	ret</span><br><span class="line"></span><br><span class="line"># long copy_block(long* src, long* dest, long len)</span><br><span class="line"># src in %rdi, dest in %rsi, len in %rdx</span><br><span class="line">copy_block:</span><br><span class="line">	irmovq $1, %r10</span><br><span class="line">	irmovq $8, %r8</span><br><span class="line">	xorq %rax, %rax</span><br><span class="line">loop:</span><br><span class="line">	andq %rdx, %rdx</span><br><span class="line">	je done</span><br><span class="line">	mrmovq (%rdi), %r9</span><br><span class="line">	addq %r8, %rdi</span><br><span class="line">	rmmovq %r9, (%rsi)</span><br><span class="line">	addq %r8, %rsi</span><br><span class="line">	xorq %r9, %rax</span><br><span class="line">	subq %r10, %rdx</span><br><span class="line">	jmp loop</span><br><span class="line">done:</span><br><span class="line">	ret</span><br><span class="line"></span><br><span class="line">	.pos 0x200</span><br><span class="line">stack:</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ArchitectureLab/sim/misc&gt; make copy.yo</span><br><span class="line">./yas copy.ys</span><br><span class="line">ArchitectureLab/sim/misc&gt; ./yis copy.yo</span><br><span class="line">Stopped <span class="keyword">in</span> <span class="number">41</span> steps at PC = <span class="number">0x13</span>.  Status <span class="string">&#x27;HLT&#x27;</span>, CC Z=<span class="number">1</span> S=<span class="number">0</span> O=<span class="number">0</span></span><br><span class="line">Changes to registers:</span><br><span class="line">%rax:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000cba</span></span><br><span class="line">%rsp:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000200</span></span><br><span class="line">%rsi:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000048</span></span><br><span class="line">%rdi:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000030</span></span><br><span class="line">%r8:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000008</span></span><br><span class="line">%r9:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000c00</span></span><br><span class="line">%r10:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000001</span></span><br><span class="line"></span><br><span class="line">Changes to memory:</span><br><span class="line"><span class="number">0x0030</span>:	<span class="number">0x0000000000000111</span>	<span class="number">0x000000000000000a</span></span><br><span class="line"><span class="number">0x0038</span>:	<span class="number">0x0000000000000222</span>	<span class="number">0x00000000000000b0</span></span><br><span class="line"><span class="number">0x0040</span>:	<span class="number">0x0000000000000333</span>	<span class="number">0x0000000000000c00</span></span><br><span class="line"><span class="number">0x01f0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x000000000000006f</span></span><br><span class="line"><span class="number">0x01f8</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000013</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Part-B"><a href="#Part-B" class="headerlink" title="Part B"></a>Part B</h2><p>实验的第二部分也不困难，只需实现一个iaddq立即数加功能即可，所需修改部分如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">bool instr_valid &#x3D; icode in </span><br><span class="line">	&#123; INOP, IHALT, IRRMOVQ, IIRMOVQ, IRMMOVQ, IMRMOVQ,</span><br><span class="line">	       IOPQ, IJXX, ICALL, IRET, IPUSHQ, IPOPQ, IIADDQ &#125;;</span><br><span class="line"></span><br><span class="line"># Does fetched instruction require a regid byte?</span><br><span class="line">bool need_regids &#x3D;</span><br><span class="line">	icode in &#123; IRRMOVQ, IOPQ, IPUSHQ, IPOPQ, </span><br><span class="line">		     IIRMOVQ, IRMMOVQ, IMRMOVQ, IIADDQ &#125;;</span><br><span class="line"></span><br><span class="line"># Does fetched instruction require a constant word?</span><br><span class="line">bool need_valC &#x3D;</span><br><span class="line">	icode in &#123; IIRMOVQ, IRMMOVQ, IMRMOVQ, IJXX, ICALL, IIADDQ &#125;;</span><br><span class="line"></span><br><span class="line">## What register should be used as the B source?</span><br><span class="line">word srcB &#x3D; [</span><br><span class="line">	icode in &#123; IOPQ, IRMMOVQ, IMRMOVQ, IIADDQ  &#125; : rB;</span><br><span class="line">	icode in &#123; IPUSHQ, IPOPQ, ICALL, IRET &#125; : RRSP;</span><br><span class="line">	1 : RNONE;  # Don&#39;t need register</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">## What register should be used as the E destination?</span><br><span class="line">word dstE &#x3D; [</span><br><span class="line">	icode in &#123; IRRMOVQ &#125; &amp;&amp; Cnd : rB;</span><br><span class="line">	icode in &#123; IIRMOVQ, IOPQ, IIADDQ&#125; : rB;</span><br><span class="line">	icode in &#123; IPUSHQ, IPOPQ, ICALL, IRET &#125; : RRSP;</span><br><span class="line">	1 : RNONE;  # Don&#39;t write any register</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">## Select input A to ALU</span><br><span class="line">word aluA &#x3D; [</span><br><span class="line">	icode in &#123; IRRMOVQ, IOPQ &#125; : valA;</span><br><span class="line">	icode in &#123; IIRMOVQ, IRMMOVQ, IMRMOVQ, IIADDQ &#125; : valC;</span><br><span class="line">	icode in &#123; ICALL, IPUSHQ &#125; : -8;</span><br><span class="line">	icode in &#123; IRET, IPOPQ &#125; : 8;</span><br><span class="line">	# Other instructions don&#39;t need ALU</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">## Select input B to ALU</span><br><span class="line">word aluB &#x3D; [</span><br><span class="line">	icode in &#123; IRMMOVQ, IMRMOVQ, IOPQ, ICALL, </span><br><span class="line">		      IPUSHQ, IRET, IPOPQ, IIADDQ &#125; : valB;</span><br><span class="line">	icode in &#123; IRRMOVQ, IIRMOVQ &#125; : 0;</span><br><span class="line">	# Other instructions don&#39;t need ALU</span><br><span class="line">];</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>后续按照实验手册测试步骤照做即可</p>
<h2 id="Part-C"><a href="#Part-C" class="headerlink" title="Part C"></a>Part C</h2><p>最后部分稍难一些，需要对流水线有较好理解后自行优化硬件逻辑及汇编代码，尽可能高效地实现函数功能。先说下我对pipe-full.hcl文件的修改。首先是听从了实验手册的建议，实现了iaddq立即数加法指令，代码修改同Part B部分。因为函数含循环涉及大量条件跳转，考虑过将跳转预测逻辑修改为后向分支跳转，前向分支不跳转（见习题4.56），但稍加分析认为在本题中修改分支预测逻辑并无提升，遂延用默认预测逻辑</p>
<p>对于ncopy.ys代码的优化，首先是利用实现的iaddq将原本的诸如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">irmovq $1, %r10</span><br><span class="line">addq %r10, %rax</span><br></pre></td></tr></table></figure>

<p>两条指令合为一条</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iaddq $1, %r10</span><br></pre></td></tr></table></figure>

<p>其次注意到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">	mrmovq (%rdi), %r10</span><br><span class="line">rmmovq %r10, (%rsi)</span><br><span class="line">andq %r10, %r10</span><br></pre></td></tr></table></figure>

<p>产生加载/使用冲突，浪费一个时钟周期，通过重排指令顺序将该周期利用起来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">	mrmovq (%rdi), %r10</span><br><span class="line">andq %r10, %r10</span><br><span class="line">rmmovq %r10, (%rsi)</span><br></pre></td></tr></table></figure>

<p>再根据实验手册建议，参考第五章循环展开部分对CPE进行优化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">	mrmovq (%rdi), %r10	# read val from src...</span><br><span class="line">	mrmovq 8(%rdi), %r11</span><br><span class="line">	mrmovq 16(%rdi), %r12</span><br><span class="line">	mrmovq 24(%rdi), %r13</span><br><span class="line">	andq %r10, %r10		# val &lt;&#x3D; 0?</span><br><span class="line">	rmmovq %r10, (%rsi)	# ...and store it to dst</span><br><span class="line">	jle Npos1		# if so, goto Npos:</span><br><span class="line">	iaddq $1, %rax		# count++</span><br><span class="line">Npos1:</span><br><span class="line">	andq %r11, %r11</span><br><span class="line">	rmmovq %r11, 8(%rsi)</span><br><span class="line">	jle Npos2</span><br><span class="line">	iaddq $1, %rax</span><br><span class="line">Npos2:</span><br><span class="line">	andq %r12, %r12</span><br><span class="line">	rmmovq %r12, 16(%rsi)</span><br><span class="line">	jle Npos3</span><br><span class="line">	iaddq $1, %rax</span><br><span class="line">Npos3:</span><br><span class="line">	andq %r13, %r13</span><br><span class="line">	rmmovq %r13, 24(%rsi)</span><br><span class="line">	jle Npos4</span><br><span class="line">	iaddq $1, %rax</span><br><span class="line">Npos4:</span><br><span class="line">	iaddq $32, %rdi		# src+&#x3D;4</span><br><span class="line">	iaddq $32, %rsi		# dst+&#x3D;4</span><br></pre></td></tr></table></figure>

<p>完整代码见下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">#&#x2F;* $begin ncopy-ys *&#x2F;</span><br><span class="line">##################################################################</span><br><span class="line"># ncopy.ys - Copy a src block of len words to dst.</span><br><span class="line"># Return the number of positive words (&gt;0) contained in src.</span><br><span class="line">#</span><br><span class="line"># Include your name and ID here.</span><br><span class="line">#</span><br><span class="line"># Describe how and why you modified the baseline code.</span><br><span class="line">#</span><br><span class="line">##################################################################</span><br><span class="line"># Do not modify this portion</span><br><span class="line"># Function prologue.</span><br><span class="line"># %rdi &#x3D; src, %rsi &#x3D; dst, %rdx &#x3D; len</span><br><span class="line">ncopy:</span><br><span class="line"></span><br><span class="line">##################################################################</span><br><span class="line"># You can modify this portion</span><br><span class="line">	# Loop header</span><br><span class="line">	xorq %rax, %rax		# count &#x3D; 0;</span><br><span class="line">	iaddq $-8, %rdx		# len -&#x3D; 8</span><br><span class="line">	andq %rdx, %rdx		# len &lt; 0?</span><br><span class="line">	jl Remain		# if so, goto Remain:</span><br><span class="line">	</span><br><span class="line">Loop:	</span><br><span class="line">	mrmovq (%rdi), %r10	# read val from src...</span><br><span class="line">	mrmovq 8(%rdi), %r11</span><br><span class="line">	mrmovq 16(%rdi), %r12</span><br><span class="line">	mrmovq 24(%rdi), %r13</span><br><span class="line">	andq %r10, %r10		# val &lt;&#x3D; 0?</span><br><span class="line">	rmmovq %r10, (%rsi)	# ...and store it to dst</span><br><span class="line">	jle Npos1		# if so, goto Npos:</span><br><span class="line">	iaddq $1, %rax		# count++</span><br><span class="line">Npos1:</span><br><span class="line">	andq %r11, %r11</span><br><span class="line">	rmmovq %r11, 8(%rsi)</span><br><span class="line">	jle Npos2</span><br><span class="line">	iaddq $1, %rax</span><br><span class="line">Npos2:</span><br><span class="line">	andq %r12, %r12</span><br><span class="line">	rmmovq %r12, 16(%rsi)</span><br><span class="line">	jle Npos3</span><br><span class="line">	iaddq $1, %rax</span><br><span class="line">Npos3:</span><br><span class="line">	andq %r13, %r13</span><br><span class="line">	rmmovq %r13, 24(%rsi)</span><br><span class="line">	jle Npos4</span><br><span class="line">	iaddq $1, %rax</span><br><span class="line">Npos4:</span><br><span class="line">	iaddq $32, %rdi		# src+&#x3D;4</span><br><span class="line">	iaddq $32, %rsi		# dst+&#x3D;4</span><br><span class="line">	</span><br><span class="line">	mrmovq (%rdi), %r10	# read val from src...</span><br><span class="line">	mrmovq 8(%rdi), %r11</span><br><span class="line">	mrmovq 16(%rdi), %r12</span><br><span class="line">	mrmovq 24(%rdi), %r13</span><br><span class="line">	andq %r10, %r10		# val &lt;&#x3D; 0?</span><br><span class="line">	rmmovq %r10, (%rsi)	# ...and store it to dst</span><br><span class="line">	jle Npos5		# if so, goto Npos:</span><br><span class="line">	iaddq $1, %rax		# count++</span><br><span class="line">Npos5:</span><br><span class="line">	andq %r11, %r11</span><br><span class="line">	rmmovq %r11, 8(%rsi)</span><br><span class="line">	jle Npos6</span><br><span class="line">	iaddq $1, %rax</span><br><span class="line">Npos6:</span><br><span class="line">	andq %r12, %r12</span><br><span class="line">	rmmovq %r12, 16(%rsi)</span><br><span class="line">	jle Npos7</span><br><span class="line">	iaddq $1, %rax</span><br><span class="line">Npos7:</span><br><span class="line">	andq %r13, %r13</span><br><span class="line">	rmmovq %r13, 24(%rsi)</span><br><span class="line">	jle Npos8</span><br><span class="line">	iaddq $1, %rax</span><br><span class="line">Npos8:</span><br><span class="line">	iaddq $32, %rdi		# src+&#x3D;4</span><br><span class="line">	iaddq $32, %rsi		# dst+&#x3D;4</span><br><span class="line">	</span><br><span class="line">	iaddq $-8, %rdx		# len -&#x3D; 8</span><br><span class="line">	jge Loop			# if so, goto Loop:</span><br><span class="line">Remain:</span><br><span class="line">	iaddq $8, %rdx</span><br><span class="line">	je Done</span><br><span class="line">Final_loop:</span><br><span class="line">	mrmovq (%rdi), %r10	# read val from src...</span><br><span class="line">	andq %r10, %r10		# val &lt;&#x3D; 0?</span><br><span class="line">	rmmovq %r10, (%rsi)	# ...and store it to dst</span><br><span class="line">	jle Npos9		# if so, goto Npos9:</span><br><span class="line">	iaddq $1, %rax		# count++</span><br><span class="line">Npos9:	</span><br><span class="line">	iaddq $8, %rdi		# src++</span><br><span class="line">	iaddq $8, %rsi		# dst++</span><br><span class="line">	iaddq $-1, %rdx		# len--</span><br><span class="line">	jg Final_loop</span><br><span class="line"></span><br><span class="line">##################################################################</span><br><span class="line"># Do not modify the following section of code</span><br><span class="line"># Function epilogue.</span><br><span class="line">Done:</span><br><span class="line">	ret</span><br><span class="line">##################################################################</span><br><span class="line"># Keep the following label at the end of your function</span><br><span class="line">End:</span><br><span class="line">#&#x2F;* $end ncopy-ys *&#x2F;</span><br></pre></td></tr></table></figure>

<p>最终测试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">unix&gt;</span><span class="bash"> make psim VERSION=full</span></span><br><span class="line"><span class="meta">unix&gt;</span><span class="bash"> ./psim -t sdriver.yo</span></span><br><span class="line"><span class="meta">unix&gt;</span><span class="bash"> ./psim -t ldriver.yo</span></span><br><span class="line"><span class="meta">unix&gt;</span><span class="bash"> ./correctness.pl</span></span><br><span class="line"><span class="meta">unix&gt;</span><span class="bash"> ./benchmark.pl</span></span><br></pre></td></tr></table></figure>

<p>最终结果Average CPE为8.70，分数为35.9。满分需要Average CPE在7.50及以下，暂时先到这里，以后有机会再考虑继续优化，完成这个实验花费了大量时间与精力</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>第四章的学习对我来说是一个巨大的挑战。当初计组考前突击刷了几年的原题，背了一些高频考点，侥幸拿了个93分，实际的水平只有自己知道。甚至一直没有弄明白流水线条件跳转指令如果分支预测错了究竟是怎样消除错误取指的影响，回到正确的位置继续运行，对旁路预取也只有一个概念性的了解。学完第四章，豁然开朗，心中埋藏已久的疑惑终才解开。其实还是能感觉到没有把流水线吃得很透，做家庭作业时明显感到有些吃力，不过哪怕过程磕磕绊绊，终究还是收获满满，对底层硬件的原理有了一个更深刻的理解</p>
<p>由衷地向硬件设计者们表达我的敬意</p>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/03/25/BUG/" rel="prev" title="BUG">
                  <i class="fa fa-chevron-left"></i> BUG
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/07/25/CSAPP-Homework/" rel="next" title="CSAPP-Homework">
                  CSAPP-Homework <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">FEZ</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">315k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">4:46</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  


















  








  

  
      <script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              const target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    const script = document.createElement('script');
    script.src = '//cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-mml-chtml.js';
    script.defer = true;
    document.head.appendChild(script);
  } else {
    MathJax.startup.document.state(0);
    MathJax.typesetClear();
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
